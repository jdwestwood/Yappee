function a(){function a(a,b,c){var d=4;this.x=a,this.y=b,this.plotX=this.x+Math.floor((2*d+1)*Math.random())-d,this.plotY=this.y+Math.floor((2*d+1)*Math.random())-d,this.startX=8+Math.floor(289*Math.random()),this.startY=8+Math.floor(64*Math.random()),this.color=c}function b(a,b,c){this.node1=a,this.node2=b,this.color=c}function c(a,b,c){this.x=a,this.y=b,this.text=c}function d(a,b,c,d){for(var e=Math.floor(360*Math.random()),f=180*3.1416*b/d,g=[],h=[],i=0;a>i;i++)g[i]=d3.hcl(e+i*f,d,c),h[i]=g[i].toString();return{HCL:g,RGB:h}}function e(d,e){function f(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=new a(e[0],e[1],e[2]);i.push(f),c.push(f)}return c}function g(a,c){for(var d=0;d<c.length;d++){var e=c[d],f=e[0],g=e[1],h=e[2];j.push(new b(a[f],a[g],h))}}function h(a){for(var b=0;b<a.length;b++){var d=a[b];k.push(new c(d[0],d[1],d[2]))}}var i=[],j=[],k=[];h([[28,38,"Yet Another Patent PErusEr"]]),d.RGB=_.shuffle(d.RGB);var l=f([[13,13,d.RGB[0]],[26,40,d.RGB[1]],[18,67,d.RGB[2]],[53,13,d.RGB[3]]]);g(l,[[0,1,e],[1,2,e],[1,3,e]]),d.RGB=_.shuffle(d.RGB);var m=f([[78,13,d.RGB[0]],[60,40,d.RGB[1]],[42,67,d.RGB[2]],[82,40,d.RGB[3]],[85,67,d.RGB[4]]]);g(m,[[0,1,e],[1,2,e],[0,3,e],[3,4,e],[1,3,e]]),d.RGB=_.shuffle(d.RGB);var n=f([[117,13,d.RGB[0]],[112,40,d.RGB[1]],[107,67,d.RGB[2]],[142,19,d.RGB[3]],[138,40,d.RGB[4]]]);g(n,[[0,1,e],[1,2,e],[0,3,e],[3,4,e],[4,1,e]]),d.RGB=_.shuffle(d.RGB);var o=f([[166,13,d.RGB[0]],[161,40,d.RGB[1]],[156,67,d.RGB[2]],[191,19,d.RGB[3]],[187,40,d.RGB[4]]]);g(o,[[0,1,e],[1,2,e],[0,3,e],[3,4,e],[4,1,e]]),d.RGB=_.shuffle(d.RGB);var p=f([[215,13,d.RGB[0]],[210,40,d.RGB[1]],[205,67,d.RGB[2]],[242,13,d.RGB[3]],[233,40,d.RGB[4]],[232,67,d.RGB[5]]]);g(p,[[0,1,e],[1,2,e],[0,3,e],[1,4,e],[2,5,e]]),d.RGB=_.shuffle(d.RGB);var q=f([[265,13,d.RGB[0]],[260,40,d.RGB[1]],[255,67,d.RGB[2]],[292,13,d.RGB[3]],[283,40,d.RGB[4]],[282,67,d.RGB[5]]]);return g(q,[[0,1,e],[1,2,e],[0,3,e],[1,4,e],[2,5,e]]),{nodes:i,lines:j,text:k}}function f(a,b){var c=d3.select("svg.yappee-graphic");c.selectAll("line.yappee-line").data(b).enter().append("svg:line").classed({"yappee-line":!0}).attr({x1:function(a){return a.node1.plotX},y1:function(a){return a.node1.plotY},x2:function(a){return a.node2.plotX},y2:function(a){return a.node2.plotY}}).style({stroke:function(a){return a.color},visibility:"hidden",opacity:0}),c.selectAll("circle.yappee-circle").data(a).enter().append("svg:circle").classed({"yappee-circle":!0}).attr({r:7}).style({fill:function(a){return a.color},visibility:"hidden"});var d=c.append("svg:text").classed({"yappee-text":!0}).attr({x:30,y:38}).style({visibility:"hidden"});d.append("svg:tspan").text("Y").classed({"yappee-text-highlight":!0}),d.append("svg:tspan").text("et "),d.append("svg:tspan").text("A").classed({"yappee-text-highlight":!0}),d.append("svg:tspan").text("nother "),d.append("svg:tspan").text("P").classed({"yappee-text-highlight":!0}),d.append("svg:tspan").text("atent "),d.append("svg:tspan").text("PE").classed({"yappee-text-highlight":!0}),d.append("svg:tspan").text("rus"),d.append("svg:tspan").text("E").classed({"yappee-text-highlight":!0}),d.append("svg:tspan").text("r")}var g=90,h=20,i=7,j=.4,k=d(i,j,g,h),l=k.HCL[Math.floor(i/2)],m=d3.hcl(l.h,l.c-15,l.l+2),n=e(k,m);f(n.nodes,n.lines,n.text)}function b(a,b){this.pParam={},this.xForceScale=d3.time.scale().domain([a.minDate,a.maxDate]).range([0,a.w]),this.xPlotScale=d3.time.scale().range([0,b.w]),this.yPlotScale=d3.scale.linear().range([0,b.h]),this.xForceToPlotScale=d3.scale.linear().domain([this.xForceScale(a.minDate),this.xForceScale(a.maxDate)]),this.yForceToPlotScale=d3.scale.linear().domain([0,a.h]),this.xAxisLabel=d3.svg.axis().orient("bottom").tickPadding(4).tickSize(2).scale(this.xPlotScale),this.xAxisGrid=d3.svg.axis().orient("bottom").tickPadding(0).innerTickSize(b.h).outerTickSize(0).scale(this.xPlotScale),this.initialize=function(){this.initializeParam(),this.initializeAxes(),zd=_.shuffle(zd),c("normal")},this.initializeParam=function(){this.pParam={minDate:void 0,maxDate:void 0,minX:void 0,maxX:void 0,minY:0,maxY:a.h,scale:1,panTransY:0,zoomTransY:0}},this.initializeAxes=function(){this.updateXPlotScaling(),this.updateYPlotScaling(),this.updateForceScaling()},this.updateXPlotScaling=function(){this.xPlotScale.domain([this.pParam.minX,this.pParam.maxX])},this.updateYPlotScaling=function(){this.yPlotScale.domain([this.pParam.minY,this.pParam.maxY])},this.updateYPlotZoomScaling=function(){this.yPlotScale.domain([this.pParam.minY-this.pParam.panTransY,this.pParam.maxY-this.pParam.panTransY])},this.updateForceScaling=function(){this.xForceToPlotScale.range([this.xPlotScale(a.minDate),this.xPlotScale(a.maxDate)]),this.yForceToPlotScale.range([this.yPlotScale(0),this.yPlotScale(a.h)])},this.updateXAxisLimits=function(){function a(){var a=d3.time.year.ceil(c).getFullYear();b.pParam.maxX=d.parse(a.toString()),b.pParam.minX=d.parse((a-5).toString()),b.pParam.maxDate=void 0,b.pParam.minDate=void 0}var b=this,c=new Date,d=d3.time.format("%Y");if(Ge.size()>0){var e=d3.max(Ge.data(),function(a){return a.date}),f=d3.min(Ge.data(),function(a){return a.date}),g=.125*(e.getTime()-f.getTime());this.pParam.minDate=d3.time.year.floor(new Date(f.getTime()-g)),this.pParam.maxDate=d3.time.year.ceil(new Date(Math.min(e.getTime()+g,c.getTime())));var h=this.pParam.minDate.getFullYear(),i=this.pParam.maxDate.getFullYear(),j=i-h;if(isNaN(j)||5>j){var k=5-j,l=Math.floor(k/2);i=Math.min(i+l,d3.time.year.ceil(c).getFullYear()),this.pParam.maxDate=d.parse(i.toString()),this.pParam.minDate=d.parse((i-5).toString())}this.pParam.minX=this.pParam.minX<this.pParam.minDate?this.pParam.minX:this.pParam.minDate,this.pParam.maxX=this.pParam.maxX>this.pParam.maxDate?this.pParam.maxX:this.pParam.maxDate,this.updateXPlotScaling(),this.zoom.x(this.xPlotScale);var m=(this.pParam.maxX.getTime()-this.pParam.minX.getTime())/315576e5;this.zoom.scaleExtent([m/300,m/1.2])}else a(),this.updateXPlotScaling()},this.updateXAxisContent=function(){if(Ge.size()>0){var a=this.pParam.maxX.getFullYear()-this.pParam.minX.getFullYear(),b=d3.time.year,c=d3.time.year;if(1>a)var d=1,c=d3.time.month,f=1;else if(a>=1&&2>=a)var d=1,c=d3.time.month,f=1;else if(a>=3&&4>=a)var d=1,c=d3.time.month,f=3;else if(a>=5&&12>=a)var d=1,c=d3.time.month,f=6;else if(a>=13&&24>=a)var d=2,f=1;else if(a>=25&&36>=a)var d=4,f=1;else if(a>=37&&60>=a)var d=5,f=1;else if(a>=61&&120>=a)var d=10,f=2;else if(a>=121&&240>=a)var d=20,f=4;else if(a>=241&&360>=a)var d=40,f=10;else if(a>=361&&500>=a)var d=50,f=10;else e("Unexpected xAxis range in updateXAxisContent");this.xAxisLabel.ticks(b,d).scale(this.xPlotScale),this.xAxisGrid.ticks(c,f).scale(this.xPlotScale),Dd.call(this.xAxisLabel),Ed.call(this.xAxisGrid),d3.selectAll("g.x-axis-label > g.tick > line").remove(),d3.selectAll("g.x-axis-grid > g.tick > text").remove()}},this.on_zoomstart=function(){e("Hello from on_zoom_start"),Ge.selectAll("circle").classed({"pointer-events-none":!0}),"normal"==this.pParam.mouse&&(Ie.select("div.pop1-container").classed({"pointer-events-none":!0}),Ie.select("g.pop1-marker").classed({"pointer-events-none":!0}),Ie.each(function(){$(this).off("mouseleave.biblio").off("mouseenter.biblio")})),Bd.on("mouseover.biblio",null).on("mousemove.biblio",null).on("mouseoout.biblio",null)},this.on_zoomend=function(){e("Hello from on_zoom_end"),Ge.selectAll("circle").classed({"pointer-events-none":!1}),"normal"==this.pParam.mouse&&(Ie.select("div.pop1-container").classed({"pointer-events-none":!1}),Ie.select("g.pop1-marker").classed({"pointer-events-none":!1}),Ie.each(function(){$(this).on("mouseleave.biblio",fc).on("mouseenter.biblio",dc)})),Bd.on("mouseover.biblio",hc).on("mousemove.biblio",hc).on("mouseoout.biblio",hc)},this.on_zoom=function(){function a(){Ge.each(function(a){a.updatePlotCoord()}),Ie.each(function(a){a.updatePlotCoord()}),Ge.call(Mc),Ke.call(Nc),He.call(Kc),Le.call(Lc)}if(!d3.event.shiftKey){e("In patentMapPlot.on_zoom, event is: ",d3.event),this.pParam.minX=this.xPlotScale.invert(0),this.pParam.maxX=this.xPlotScale.invert(b.w);var c=this.zoom.translate()[1];this.zoom.scale()==this.pParam.scale?(this.pParam.panTransY=c-this.pParam.zoomTransY,this.updateYPlotZoomScaling()):(this.pParam.scale=this.zoom.scale(),this.pParam.zoomTransY=c-this.pParam.panTransY),this.updateXAxisContent(),this.updateForceScaling(),a()}},this.zoom=d3.behavior.zoom().on("zoom",this.on_zoom.bind(this)).on("zoomstart",this.on_zoomstart.bind(this)).on("zoomend",this.on_zoomend.bind(this)).x(this.xPlotScale),this.initialize()}function c(a){switch(yd.mouse=a,a){case"transparent":$("span.mouse-mode-state").text("Transparent");break;case"normal":$("span.mouse-mode-state").text("Normal")}}function d(){var a=Id.append("svg:g").classed({"node-legend":!0}).attr({transform:"translate(71,54)"});a.append("svg:line").classed({"node-legend-cited":!0}).attr({x1:"0",y1:"0",x2:"-40",y2:"0"}),a.append("svg:line").classed({"node-legend-citing":!0}).attr({x1:"0",y1:"0",x2:"20",y2:"-35"}),a.append("svg:line").classed({"node-legend-related":!0}).attr({x1:"0",y1:"0",x2:"20",y2:"35"});var b=a.append("svg:g").attr({transform:"translate(0,0)"});b.append("svg:circle").classed({"node-legend-node":!0}).attr({r:"10",cx:"0",cy:"0"}),b.append("svg:use").attr({"xlink:href":"#force-mapped-cross-def"});var c=b.append("svg:text").classed({"node-label":!0}).attr({"text-anchor":"middle",x:"30",y:"-8"}).text("Mapped");c.append("svg:tspan").attr({"text-anchor":"middle",x:"30",y:"4"}).text("patent");var d=a.append("svg:g").attr({transform:"translate(-40,0)"});d.append("svg:circle").classed({"node-legend-node":!0}).attr({r:"7",cx:"0",cy:"0"});var e=d.append("svg:text").classed({"node-label":!0}).attr({"text-anchor":"middle",x:"0",y:"-20"}).text("Cited patent");e.append("svg:tspan").attr({"text-anchor":"middle",x:"0",y:"-8"}).text("(USPTO)");var f=a.append("svg:g").attr({transform:"translate(20,-35)"});f.append("svg:circle").classed({"node-legend-node":!0}).attr({r:"7",cx:"0",cy:"0"});var g=f.append("svg:text").classed({"node-label":!0}).attr({"text-anchor":"middle",x:"-31",y:"-11"}).text("Citing patent");g.append("svg:tspan").attr({"text-anchor":"middle",x:"-31",y:"1"}).text("(USPTO)");var h=a.append("svg:g").attr({transform:"translate(20,35)"});h.append("svg:circle").classed({"node-legend-node":!0}).attr({r:"7",cx:"0",cy:"0"});var i=h.append("svg:text").classed({"node-label":!0}).attr({"text-anchor":"middle",x:"-32",y:"-10"}).text("Related patent");i.append("svg:tspan").attr({"text-anchor":"middle",x:"-32",y:"2"}).text("(Google)");var j=Id.node().getBBox();Id.insert("svg:rect",":first-child").classed({"legend-frame":!0}).attr({x:"-4",y:"-4",width:j.width+11,height:j.height+8})}function e(){Kd&&console.log.apply(console,arguments)}function f(){function a(){this.count<=0?($.removeCookie("yappee_cl"),e("In cookieTracker, deleted a cookie for total count of "+this.count)):e("In cookieTracker, did not delete cookie due to total count of "+this.count)}this.count=0,this.start=function(){this.count+=1,e("In cookieTracker, added a cookie for total count of "+this.count),$.cookie("yappee_cl",Ld)},this.end=function(b){var c=b?b:0;this.count-=1,e("In cookieTracker, received end request with delay time of "+c+" msec. New count is "+this.count),window.setTimeout(a.bind(this),c)}}function g(){Ld=$.cookie("yappee_cl"),$.removeCookie("yappee_cl"),$(document).data("docDeferred").resolve()}function h(a){$("body").append(a),Xd=_.template($("script#bs_nav-tab").html()),Yd=_.template($("script#bs_tab-pane").html()),Rd=_.template($("script#prior-art-popover-title").html()),Sd=_.template($("script#prior-art-popover-content").html()),Qd=_.template($("script#patent-info-popover").html()),Oe=_.template($("script#force-biblio").html()),ue=_.template($("script#mapped-list-entry-section").html()),ve=_.template($("script#favorites-list-entry-section").html()),we=_.template($("script#patent-list-patent-section").html()),xe=_.template($("script#patent-list-reference-section").html()),Zd=_.template($("script#prior-art-table").html())}function i(){l(),Oc(),window.setTimeout(j,700)}function j(){var a=d3.select("svg.yappee-graphic");a.selectAll("line.yappee-line").style({visibility:"visible"}),a.selectAll("text.yappee-text").style({visibility:"visible"});var b=a.transition().duration(1e3).ease("linear");b.each(function(){a.selectAll("circle.yappee-circle").transition().each("start",function(){d3.select(this).style({visibility:"visible"})}).attrTween("cx",function(a){return d3.interpolate(a.startX,a.plotX)}).attrTween("cy",function(a){return d3.interpolate(a.startY,a.plotY)})});var c=b.transition().duration(2e3),d=c.transition().duration(250);d.each(function(){a.selectAll("text.yappee-text").transition().style({opacity:0})});var e=c.transition().duration(500);e.each(function(){a.selectAll("line.yappee-line").transition().style({opacity:1})}),e.transition().each("end",k)}function k(){d3.selectAll("text.yappee-text").style({visibility:"hidden",opacity:1}),Td.setupInitialTabs()}function l(){$("a#gAdvSearchForm").on("click.loadGoogle",m)}function m(){var a=$("iframe#gps");if(""==a.attr("src")){var b="advanced_patent_search";Md.start(),$("iframe#gps").load(n),$("iframe#gps").attr("src",b)}else $("a#gAdvSearchForm").off("click.loadGoogle")}function n(){function a(a){a.preventDefault();var c=$(this);c.css("display","none");var d=c.serializeArray(),e=c.attr("action"),f=c.serialize();s(e+"?"+f,"",d,b)}function b(){d.css("display","block")}var c=$(this).contents();$("head",c).append($("script#advanced-patent-search-style").html());var d=$("form[action='/patents']",c);d.children("table").first().remove(),d.children("table").first().before($("script#page-header").html()),$("span#jdw-top-row",c).append($("script#advanced-patent-search").html()),$("font",c).each(function(){$(this).replaceWith($(this).html())}),$("tr[style]",c).attr("bgcolor","ffffff").removeAttr("style"),$("center:contains('Â©')",c).remove(),d.on("submit",a),Md.end(500),window.focus()}function o(){function a(a,b,c,d){a.popover({placement:"bottom",trigger:"hover",html:!0,title:b,content:c}),a.popover("disable");var e=a.data("bs.popover");$(e.tip()).addClass(d).children("div,h3").addClass(d)}function b(a){var b=a.attr("href"),d=$("div"+b+" iframe").contents(),e=c(d),f=a.data("bs.popover"),g=f.options.content,h=$(g,g),i=$("td#jdw-pop-search-terms",g).html(e.searchTerms),j=$("td#jdw-pop-start-date",g).html(e.startDate),k=$("td#jdw-pop-end-date",g).html(e.endDate);$("td#jdw-pop-search-terms",h).replaceWith(i),$("td#jdw-pop-start-date",h).replaceWith(j),$("td#jdw-pop-end-date",h).replaceWith(k),f.options.content=h[0].outerHTML}function c(a){var b="";$("div.search-term-wrapper span.jfk-checkbox-checked",a).parent().parent().each(function(a){b+=0==a?$(this).text().trim():"<br>"+$(this).text().trim()});var c=$("tr#start-date input",a).val();""==c&&(c="Any");var d=$("tr#end-date input",a).val();return""==d&&(d="Any"),{searchTerms:b,startDate:c,endDate:d}}this.setupInitialTabs=function(){$("head").append($("script#customize-bootstrap-styles").html());var a=$("a[data-toggle='tab']");a.on("shown.bs.tab",this.on_tab_shown.bind(this))},this.on_tab_shown=function(a){var c=$(a.target);if(c.data("bs.popover")&&(c.popover("hide"),c.popover("disable")),a.relatedTarget){var d=$(a.relatedTarget);if(d.data("bs.popover")){d.popover("enable");var e=d.attr("id");"relatedTab"==e.slice(0,10)&&b(d)}}},this.setupPatentTab=function(b,c){function d(a){var b=$("span.patent-number",a).text();return b&&(b=b.replace(/\s/g,""),"US"==b.slice(0,2)&&(b=b.replace(/[A-Z]?\d?$/,""))),b}var e=d(c),f=ub(c),g=f.inventors.replace(/, (?!Jr|JR|II|IV)/g,"<br/>"),h=f.assignee.replace(/, (?!Jr|JR|II|IV)/g,"<br/>"),i=Qd({inventors:g,assignee:h}),j=$("a#"+b).attr("data-patent",e);return G(j,document,"main",e),a(j,f.title,i,"jdwpatent"),j.on("shown.bs.tab",this.on_tab_shown.bind(this)),e},this.setupSearchTabPopover=function(b,c){var d=$("a#"+b);a(d,"Search",c,"jdwsearch"),d.on("shown.bs.tab",this.on_tab_shown.bind(this))},this.setupPriorArtTabPopover=function(b,d){var e=$("div#patent-metadata-box h2 a",d).text(),f=$("div#patent-metadata-box div#title",d).text(),g=c(d),h=Rd({patent_no:e,patent_title:f}),i=Sd({searchTerms:g.searchTerms,startDate:g.startDate,endDate:g.endDate}),j=$("a#"+b);a(j,h,i,"jdwprior")},this.deleteTab=function(a){var b=$(a.target),c=b.closest("a"),d=$("li.active > a");nextTab=d.get(0)==c.get(0)?c.parent().prev().children("a"):d,nextTab.tab("show"),$("div"+c.attr("href")).remove(),b.closest("li").remove()}}function p(){this.validatePatent=function(b,c){function d(a){e("In patentPicker, checkGooglePatent response is ",a),c(a.error?{url:"",label:"",error:"Patent not found"}:{url:i,label:patentLabel,error:""})}function f(){if(!q&&p){if(s.post)for(kc_post in s.post)if(-1!=s.post[kc_post].indexOf(p))return;q=p,p=""}}function g(a,b){return a?-1!=b.kc.indexOf(a)?!0:!1:!0}function h(a,b,c,d){return a?c[d]?b?b in c[d]&&-1!=c[d][b].indexOf(a)?!0:!1:!0:!1:!0}var i="";patentLabel="";var j="",k=b.toUpperCase();k=k.replace(/\s/g,""),-1!=k.search(/[\W_]/);var l=de.exec(k);if(l){var m=l[0],n=l[1],o=l[2],p=(l[3],l[4]),q=l[5];if(n in a){var s=a[n];if(f(),g(q,s))if(h(o,q,s,"pref")){if(h(p,q,s,"post"))return i="/patents/"+m,patentLabel=A(m),void r(i,d);j="Please try again"}else j="Please try again";else j="Please try again"}else j="Invalid country code"}else j="Please try again";c({url:"",label:"",error:j})},this.getPatent=function(a,b,c){function d(a){fe.finishTask(1),J(a,"btn-map-add","add"),M(a,"map",g)}function f(){e.log("In randomPatentPicker.mapRandomPatent, failed to create tab for patent "+b)}function g(){Eb(),Fb(),c&&c(b)}fe.initialize("Fetching patent",void 0),fe.startTask(1),e("In patentPicker, getting Google patent url "+a+" and making a patent tab labeled "+b),$.when(z(a,b)).done(d).fail(f)},this.showError=function(a){$("div.patent-input-error").addClass("make-displayed").text(a),$("input.input-patent").focus(),$("input.input-patent").select()},this.clearError=function(){$("div.patent-input-error").removeClass("make-displayed").text("")};var a={AP:{kc:["A","D0"]},AR:{kc:["A1","A2","A3","A4","A6","Q"]},AT:{kc:["A","A1","A2","A3","A4","A5","A8","A9","B","B1","B2","B8","B9","D","T","U1","U2","U3","U8","U9"],pref:{A:["A"]}},AU:{kc:["A","A1","A2","A3","A4","A5","A6","A8","A9","B","B1","B2","B3","B4","B8","B9","C","C1","C4","C8","C9","D0","S"],pref:{D0:["PN","PM","PO","PP","PA","PR","PW"]}},BA:{kc:["A","B1","D"]},BE:{kc:["A","A0","A1","A2","A3","A4","A5","A6","A7","A8","B3","B5","B6","D","T1","T2"]},BG:{kc:["A","A1","A2","A3","A4","B1","B2","U","U1","Y1","Y2"]},BR:{kc:["A","A2","A8","B","B1","B8","C1","C2","C3","C4","C5","C6","C7","C8","D0","E2","F1","K1","S","S1","U","U2","Y1","Y8"],pref:{A:["PI"],A2:["PI"],A8:["PI"],B:["PI"],B1:["PI"],B8:["PI"],C1:["PI"],C2:["PI"],C3:["PI"],C4:["PI"],C5:["PI"],C6:["PI"],C7:["PI"],C8:["PI"],E2:["PI"],F1:["PI"],S:["D"],U:["MU"],U2:["MU"],Y1:["MU"],Y8:["MU"]}},BY:{kc:["C1","U"]},CA:{kc:["A","A1","A2","B","C","C2","E","F","S"]},CH:{kc:["A","A1","A2","A3","A4","A5","A8","A9","B","B1","B5","B8","B9","C1","C2","C3","C9","D","E","H1","H2","H3","H9"],post:{A3:["G"]}},CL:{kc:["A1","B","S1","U","Y"]},CN:{kc:["A","B","C","K1","K2","K3","K4","K5","S","U","Y"]},CO:{kc:["A1","A2","U","U1"]},CR:{kc:["A","S","U"]},CS:{kc:["A","A1","A2","B1","B2","B3","B4","B5","B6","C"]},CU:{kc:["A","A1","A2","A3","A5","A6","A7","B6","B7","L"]},CY:{kc:["A","B1","B2","T1"]},CZ:{kc:["A3","B6","U1"]},DD:{kc:["A","A1","A2","A3","A4","A5","A6","A7","A8","A9","B","B1","B2","B3","B5","C2","C4","C5","T1","U"]},DE:{kc:["A","A1","A5","A8","A9","B","B1","B2","B3","B4","B8","B9","C","C1","C2","C3","C4","C5","C8","C9","D1","D2","I1","I2","T","T1","T2","T3","T4","T5","T8","T9","U","U1","U8","U9"]},DK:{kc:["A","B","B1","B2","B3","C","D0","K1","L","T1","T3","T4","T5","U1","U3","U4","Y3","Y4","Y5","Y6","Z6"]},DO:{kc:["A","S","U"],pref:{A:["P"],S:["S"],U:["U"]}},DZ:{kc:["A1"]},EA:{kc:["A1","A2","A3","A8","B1","B2","B8","B9"]},EC:{kc:["A","S","U"],pref:{A:["SP"],S:["SDI"],U:["SM","SMU"]}},EE:{kc:["A","B1","U1"]},EG:{kc:["A"]},EP:{kc:["A1","A2","A3","A4","A8","A9","B1","B2","B3","B8","B9"]},ES:{kc:["A1","A2","A3","A4","A6","A8","A9","B1","B2","B3","B8","B9","D","D0","H1","H3","K1","R","R1","R2","T1","T2","T3","T4","T5","T7","T8","T9","U","U4","U8","U9","X1","X3","Y","Y4"]},FI:{kc:["A","A0","A1","A7","B","B1","B2","B3","C","L","U0","U1"]},FR:{kc:["A","A1","A2","A3","A4","A5","A6","A7","A8","B","B1","B2","B3","B4","E","F","M","T"]},GB:{kc:["A","A8","A9","B","B8","C","C2","D0"]},GC:{kc:["A"]},GE:{kc:["A","B","U","Y"],pref:{A:["AP"],B:["P","AP"],U:["U","AU"],Y:["U"]}},GR:{kc:["A","A1","A7","B","B1","B2","T1","T3","T7","U","Y"]},GT:{kc:["A","S","U"],post:{A:["A","B","C"]}},HK:{kc:["A","A1","A2"]},HN:{kc:["A","S1","U"]},HR:{kc:["A2","A8","A9","B1","B3","B4","B8","B9","C1","T1","T2","T3","T4","T5","T8"],pref:{A2:["P"],A8:["P"],A9:["P"],B1:["P","PK"],B3:["PK"],B4:["PK"],B8:["P"],B9:["P"],C1:["P"],T1:["P"],T2:["P"],T3:["P"],T4:["P"],T5:["P"],T8:["P"]}},HU:{kc:["A","A1","A2","A3","A9","B","B1","D0","U","V0"],pref:{A:["H","T"]}},ID:{kc:["A","B","S"]},IE:{kc:["A1","A2","B1","B2","L"],pref:{A2:["S"],B2:["S"],L:["S"]}},IL:{kc:["A","D0"]},IN:{kc:["A1","E"]},IS:{kc:["A","A7","B","B2","B3","B6"]},IT:{kc:["A","A1","A3","A4","B","B1","D0","T1","T2","T3","U1","U3","U4","V0","Y1","Z2"],pref:{A1:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],A3:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],A4:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],DO:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],T1:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],T2:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],T3:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],U1:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],U3:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],U4:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],V0:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"],Y1:["BO","SS","GO","VI","AN","AP","AR","PA","UD","LE","TO","MI","WX","VT","AG","MI","AL","VV","VR","AQ","SV","PS","PD","NA","SA","CS","GE","TP","IS","FI","BG","VC","BS","PG"]}},JO:{kc:["B"]},JP:{kc:["A","A1","B","B1","B2","C1","C2","K1","K2","K4","K5","S","U","U3","Y1","Y2","Z1","Z2"],pref:{A:["S","H"],A1:["WO"],B1:["S","H"],B2:["S","H"],K1:["S","H"],K2:["S","H"],K4:["S","H"],K5:["S","H"],U:["S","H"],Y1:["S","H"],Y2:["S","H"]}},KE:{kc:["A","D"]},KR:{kc:["A","B1","K1","K2","S","U","Y1"]},KZ:{kc:["A","B"]},LT:{kc:["A","B","R3"]},LU:{kc:["A","A1","A2","A7","D","I2"]},LV:{kc:["A","A3","A4","B","B4"]},MA:{kc:["A1","B1"]},MC:{kc:["A","E"]},MD:{kc:["A","A0","A1","A2","A3","B1","B2","C1","C2","E","F1","F2","F3","G2","U","W1","W2","Y","Y1","Y2","Z","Z2"]},ME:{kc:["A"]},MN:{kc:["A6"]},MT:{kc:["A"],pref:{A:["P"]}},MW:{kc:["A1"]},MX:{kc:["A","B","E"],pref:{A:["PA","YU","GT","JL","NL"]}},MY:{kc:["A","U"]},NI:{kc:["A"]},NL:{kc:["A","A1","B","C","C1","C2","C8","I1","I2","T"]},NO:{kc:["A","B","B1","B2","B3","C","D0","I1","I2","L"]},NZ:{kc:["A"]},OA:{kc:["A","E"]},PA:{kc:["A1","A2"]},PE:{kc:["A1","Z"]},PH:{kc:["A","U"]},PL:{kc:["A1","A2","A3","A4","A5","A6","B1","B2","B3","B4","T3","U1","U3","Y1","Y3"]},PT:{kc:["A","A1","B","B1","D","E","T","U","W","Y"]},RO:{kc:["A","A0","A1","A2","A3","A7","A8","B","B1","B2","B8","B9","C1","U1","U2","U8"]},RS:{kc:["A","A1","A2","A3","B","U"]},RU:{kc:["A","A8","C","C1","C2","C8","C9","K1","K3","S","U1","U8"]},SE:{kc:["A","A0","A1","A2","B","C","C1","C2","C3","C5","C8","D0","E","E5","K3","L"]},SG:{kc:["A1","A2","G"]},SI:{kc:["A","A1","A2","A8","B","T1","T2"]},SK:{kc:["A3","B6","U1","Y1","Y2"]},SM:{kc:["A","B","S","S1","S2","S3","S4"],pref:{A:["AP"],B:["P","T"],S4:["C"]}},SU:{kc:["A","A1","A2","A3","A4","K1","T"]},SV:{kc:["A"]},TH:{kc:["A"]},TJ:{kc:["A","B","R3","U","Y3"]},TR:{kc:["A","A1","A2","A3","T1","T2","T3","T4","U","U1","U2","Y"]},TT:{kc:["B"]},TW:{kc:["A","B","K1","K2","S","U"],pref:{B:["I"],K2:["I"],S:["D"],U:["M"]}},UA:{kc:["A","A1","C2","U"]},US:{kc:["A","A1","A2","A9","B","B1","B2","B3","C1","C2","E","E1","F1","F2","H","H1","I1","I3","I4","I5","P","P1","P2","P3","S","S1"],pref:{E:["RE"],E1:["RE"],F1:["RE"],H:["H"],H1:["H"],I1:["X"],I3:["AI"],I4:["T"],I5:["B"],S:["D"],S1:["D"]}},UY:{kc:["A","A1","A2","A3","Q","U"]},UZ:{kc:["B"]},VN:{kc:["A1","A6","U"]},WO:{kc:["A1","A2","A3","A4","A8","A9","B1","B8","K1"]},YU:{kc:["A","B","U"],pref:{A:["P"],U:["MP"]}},ZA:{kc:["A","D"]},ZM:{kc:["A1","D"]},ZW:{kc:["A1"]}}}function q(){this.maxTries=20,this.initialize=function(){fe.initialize("Finding random patent",void 0),fe.startTask(1)},this.mapRandomPatent=function(a){function b(b){fe.finishTask(1),b.error?h<this.maxTries?(e("In randomPatentPicker, retry "+h),h+=1,this.mapRandomPatent(a)):e("In randomPatentPicker, max retries "+this.maxTries+" exceeded. Exiting..."):(i=A(USpatent),$.when(z(j,i)).done(c).fail(d))}function c(a){fe.finishTask(1),J(a,"btn-map-add","add"),M(a,"map",f)}function d(){e.log("In randomPatentPicker.mapRandomPatent, failed to create tab for patent "+USpatent)}function f(){Eb(),Fb(),a&&a(i)}function g(){for(var a=0;20>a;a++){var b=Ud.min+Math.floor((Ud.max-Ud.min+1)*Math.random()),c="US"+b,d=!1,e=ke.map.length>0?ke.map:ke.cleared.map;for(iPat=0;iPat<e.length;iPat++){var f=e[iPat];if(A(f)==A(c)){d=!0;break}}if(!d)return c}return void 0}this.initialize();var h=0,i="",j="";USpatent=g(),USpatent?(fe.startTask(1),j="/patents/"+USpatent,r(j,b.bind(this))):e("In randomPatentPicker, could not find a patent that was not already mapped!")}}function r(a,b){Md.start(),$.ajax({type:"HEAD",url:a,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(a,c){b({data:a,status:c})},error:function(a,c,d){e("In checkGooglePatent, error returned from HEAD request: '"+d+"'",a),b({status:c,error:d})}}),Md.end(0)}function s(a,b,c,d){function e(){var a=$(this).contents();C(a,"search"),t(a,m.html()),Td.setupSearchTabPopover(g,n.html()),l.tab("show"),window.scrollTo(0,0),window.focus(),window.setTimeout(function(){o.css("visibility","visible")},1e3),Md.end(1500),d&&d()}$d+=1;var f=""==b?"S-"+$d.toString():b,g="searchTab_"+$d,h="result_"+$d,i="gps_result_"+$d,j=Xd({tab_id:g,tab_content_id:h,tab_name:f}),k=Yd({tab_content_id:h,iframe_id:i,iframe_width:1050,iframe_height:qd});$("div.tab-pane.active").after(k),$("ul#topTabs li.active").after(j);var l=$("a#"+g);l.find("button.close-tab").on("click",Td.deleteTab);var m=new x("script#search-term-table",c),n=new x("script#search-term-popover",c),o=$("iframe#"+i);o.css("visibility","hidden").on("load",e),Md.start(),$("iframe#"+i).attr("src",a)}function t(a,b){function c(){$("p#bfl",a).parent().remove(),$("div#gfn",a).remove(),$("div#fll",a).remove(),$("div#footcnt",a).remove()}function d(){var a=$(this).find("cite");if(a.size()>0){var b=a.text(),c=be.exec(b);if(c)return!1;$(this).remove()}else $(this).remove()}$("head",a).append($("script#search-term-table-style").html()),$("body",a).addClass("make-invisible"),c(),$("div.osl",a).each(function(){$(this).contents().slice(-2).remove()});var e=$("div#cst",a);B($("body",a),$("div#center_col",a)),$("body",a).prepend(e),$("body",a).prepend($("script#page-header").html()),$("span#jdw-top-row",a).append(b),$("body",a).append($("script#search-page-more-results-style").html()),$("li.g",a).each(d),$("li.normal-footer, li.normal-footer + hr.rgsep",a).remove(),$("li.g div.s cite",a).closest("div").contents().filter(function(){return"CITE"!=this.nodeName}).remove(),$("body",a).removeClass("make-invisible"),$("div#ires h3.r",a).prepend($("script#search-page-button-content").html()),$("li.g span.btn-hide-add",a).on("click",function(b){v(b,a)}),$("li.g span.btn-map-add",a).each(function(){var b=F(this,a,"search").patent_no;$(this).attr("data-patent",b).on("click",{$context:a,page:"search"},H),-1!=ke.map.indexOf(b)&&$(this).addClass("show-result-btn")}),$("li.g span.btn-favorite-add",a).each(function(){var b=F(this,a,"search").patent_no;$(this).attr("data-patent",b).on("click",{$context:a,page:"search"},H),-1!=ke.favorites.indexOf(b)&&$(this).addClass("show-result-btn")}),$("div#res",a).before($("script#search-page-unhide-results").html()),$("span.hidden-results-message",a).data("nHidden",0),$("span.hidden-results-clear-btn",a).on("click",function(b){u(b,a)})}function u(a,b){$(a.target,b).parent().addClass("hidden-show-all"),$("li.hide-result",b).removeClass("hide-result"),$("span.hidden-results-message",b).data("nHidden",0)}function v(a,b){var c=$(a.target,b),d=c.closest("li.g",b);d.addClass("hide-result");var e=$("span.hidden-results-message",b),f=e.data("nHidden")+1;e.data("nHidden",f),e.text(1==f?f.toString()+" result hidden below.":f.toString()+" results hidden below."),$("div.hidden-results-info",b).removeClass("hidden-show-all")}function w(a,b){function c(b){var c=$(this).contents();C(c,"search"),t(c,b.data.htmlSearchTermsTable),Md.end(1500),window.scrollTo(0,0),window.focus(),window.setTimeout(function(){a.css("visibility","visible")},1e3)}htmlSearchTermsTable=$("div#jdw1",a.contents()).clone(),a.off("load"),a.css("visibility","hidden").on("load",{htmlSearchTermsTable:htmlSearchTermsTable},c),Md.start(),a.attr("src",b)}function x(a,b){function c(a){var b=e(),c=d(),f={},g="",h="",i="",j=0;return a.forEach(function(a){if(g=a.name,c.formFields[g])switch(h=c.formFields[g],i=a.value,h){case"All of: ":case"Exactly: ":case"At least one: ":case"None of: ":case"Patent: ":case"Title: ":case"Inventor: ":case"Assignee: ":case"US class: ":case"Intl class: ":case"Coop class: ":""!=i&&(j+=1,b["t"+j]=h,b["v"+j]=i);break;case"Type: ":case"ChkBoxPatDateOptions":case"MinMonth":case"MinYear":case"MaxMonth":case"MaxYear":case"Restrict by":f[h]=i}}),j=4*Math.ceil(j/4),j+=1,b["t"+j]="Type: ",b["v"+j]=c.type[f["Type: "]],"q"==f.ChkBoxPatDateOptions?(j+=1,b["t"+j]="Date: ",b["v"+j]="Any"):(j+=1,b["t"+j]="Start date: ",b["v"+j]=""==f.MinYear?"Any":c.month[f.MinMonth]+f.MinYear,j+=1,b["t"+j]="End date: ",b["v"+j]=""==f.MaxYear?"Any":c.month[f.MaxMonth]+f.MaxYear,j+=1,b["t"+j]="Restrict by: ",b["v"+j]=c.restrictBy[f["Restrict by"]]),b}function d(){return{formFields:{as_q:"All of: ",as_epq:"Exactly: ",as_oq:"At least one: ",as_eq:"None of: ",as_pnum:"Patent: ",as_vt:"Title: ",as_pinvent:"Inventor: ",as_pasgnee:"Assignee: ",as_pusc:"US class: ",as_pintlc:"Int'l class: ",as_pcoopc:"Coop class: ",as_ptypeorstatus:"Type: ",as_drrb_is:"ChkBoxPatDateOptions",as_minm_is:"MinMonth",as_miny_is:"MinYear",as_maxm_is:"MaxMonth",as_maxy_is:"MaxYear",as_pdatetype:"Restrict by"},type:{0:"Any",1:"Application",2:"Issued",3:"Utility",4:"Design",5:"Plant",6:"Other",7:"Other",8:"Other"},restrictBy:{1:"Appl. date",2:"Issue date"},month:{0:"",1:"Jan ",2:"Feb ",3:"Mar ",4:"Apr ",5:"May ",6:"Jun ",7:"Jul ",8:"Aug ",9:"Sep ",10:"Oct ",11:"Nov ",12:"Dec "}}
}function e(){return{t1:"",v1:"",t2:"",v2:"",t3:"",v3:"",t4:"",v4:"",t5:"",v5:"",t6:"",v6:"",t7:"",v7:"",t8:"",v8:"",t9:"",v9:"",t10:"",v10:"",t11:"",v11:"",t12:"",v12:"",t13:"",v13:"",t14:"",v14:"",t15:"",v15:"",t16:"",v16:""}}this.html=function(){var d=c(b);return _.template($(a).html(),d)}}function y(a){function b(){var a=$(this).contents();$("head",a).append($("script#search-term-table-style").html()),$("body",a).addClass("make-invisible"),$("td.content-td",a).on("webkitAnimationStart","div.r",c),$("td.content-td",a).on("animationstart","div.r",c),$("td.metadata-td",a).on("webkitAnimationStart","div.metadata",{tab_id:n,$context:a},d),$("td.metadata-td",a).on("animationstart","div.metadata",{tab_id:n,$context:a},d),C(a,"related"),B($("body",a),$("div.main-content-wrapper",a)),$("body",a).prepend($("script#page-header").html()),$("span#jdw-top-row",a).append(t),$("div#footer",a).remove(),s.on("shown.bs.tab",Td.on_tab_shown.bind(Td)),s.tab("show"),window.scrollTo(0,0),window.focus(),window.setTimeout(function(){u.css("visibility","visible")},2e3)}function c(){function a(){var a=b.find("cite");if(a.size()>0){var c=a.text(),d=be.exec(c);d||b.remove()}else b.remove()}var b=$(this),c=b.contents();a(),C(b,"related");var d=$("span.t",b);if(1==$("span",d).length){var e=$("span.hide-result-btn",d);e.addClass("btn-original").attr("title","Hide").after($("script#related-art-page-button-content").html());var f=$("span.btn-map-add",d),g=F(f,c,"related").patent_no;G(d,c,"related",g)}}function d(a){var b=$(this),c=a.data.$context;n=a.data.tab_id,C(b,"related-root"),$("div#discuss-this-parent",c).remove(),$("div.metadata h2",c).prepend($("script#related-art-page-button-content").html());var d=$("div.metadata span.btn-map-add",c);$("div.jfk-button.jfk-button-action",c).on("mousedown.loadGoogle",e).on("mouseout.loadGoogle",f),$leftNav=$("div#left-nav-container",c).on("mousedown.loadGoogle","span.jfk-checkbox, span.search-term-text, span.delete-term-btn",function(a){$(a.target).data("mousedown","true")}).on("mouseup.loadGoogle","span.jfk-checkbox, span.search-term-text, span.delete-term-btn",g).on("mouseout.loadGoogle","span.jfk-checkbox, span.search-term-text, span.delete-term-btn",f).on("keydown.loadGoogle","input.jfk-textinput",h).on("keyup.loadGoogle","input.jfk-textinput",j),$("input.jfk-textinput",c).on("blur.loadGoogle",i),$(c).on("mouseup.loadGoogle",{leftNav:$leftNav},function(){$leftNav.find("span.jfk-checkbox, span.search-term-text, span.delete-term-btn").data("mousedown","false")}),l=F(d,c,"related-root").patent_no,G(b,c,"related-root",l),Td.setupPriorArtTabPopover(n,c),Md.end(1e3),$("body",c).removeClass("make-invisible"),$("a#"+n).click()}function e(){Md.start()}function f(){Md.end(0)}function g(a){var b=$(a.target);"true"==b.data("mousedown")&&Md.start()}function h(){Md.start()}function i(){Md.end(0)}function j(a){13==a.keyCode&&Md.end(0)}ae+=1;var k=be.exec(unescape(a)),l=k?k[1]:"",m="Re-"+l,n="relatedTab_"+ae,o="related_"+ae,p="gps_related_"+ae,q=Xd({tab_id:n,tab_content_id:o,tab_name:m}),r=Yd({tab_content_id:o,iframe_id:p,iframe_width:1220,iframe_height:qd});$("div.tab-pane.active").after(r),$("ul#topTabs li.active").after(q);var s=$("a#"+n);s.find("button.close-tab").on("click",Td.deleteTab);var t=Zd({patent_no:l}),u=$("iframe#"+p);u.css("visibility","hidden").load(b),Md.start(),$("iframe#"+p).attr("src",a)}function z(a,b){function c(a,b){function c(a){Md.end(500),f.reject(),e("In on_patent_load_error, error event is ",a)}function g(){function a(a){function b(b){switch($(b.target).text()){case"Find prior art":var c=$("a#appbar-patents-prior-art-finder-link",a).attr("href");y(c+"#c=p");break;case"View PDF":var d=$("a#appbar-read-patent-link",a).attr("href");window.open(d);break;case"Download PDF":var d=$("a#appbar-download-pdf-link",a).attr("href");window.open(d)}}$("div.goog-inline-block.jfk-button",a).each(function(){var a=$(this).text();"Application"!=a&&"Grant"!=a&&"Find prior art"!=a&&"View PDF"!=a&&"Download PDF"!=a&&$(this).remove()}),$("div[role='button'] img[src*='settings.png']",a).parent().parent().remove();var c=($("div#left-toolbar-buttons",a),$("div#right-toolbar-buttons div.viewport-chrome-toolbar",a));c.replaceWith(c.clone("false"));var d=$("div#right-toolbar-buttons div.viewport-chrome-toolbar",a);d.on("mousedown",Nb),d.on("click",b)}function b(){var a=$(this);switch(a.prop("tagName")){case"TABLE":return!1;case"SCRIPT":return;default:a.hasClass("kd-appbar")||a.remove()}}function c(a){o.css("visibility","hidden"),Md.start();var b=$(this.ownerDocument),c=a.data.index,d=$("a[data-label='Application']",b).eq(c).attr("href"),e=be.exec(d),f=e?e[1]:"";$("ul#topTabs li.active > a > span").text(f),window.scrollTo(0,0)}function e(a){o.css("visibility","hidden"),Md.start();var b=$(this.ownerDocument),c=a.data.index,d=$("a[data-label='Grant']",b).eq(c).attr("href"),e=be.exec(d),f=e?e[1]:"";$("ul#topTabs li.active > a > span").text(f),window.scrollTo(0,0)}function g(){o.css("visibility","hidden");var a=($(this.ownerDocument.body),$(this).attr("href")),b=be.exec(a),c=b?b[1]:"";ce.some(function(b){return a.search(b)>=0?!0:!1})||(Md.start(),$("ul#topTabs li.active > a > span").text(c)),window.scrollTo(0,0)}var i=$(this).contents();$("head",i).append($("script#search-term-table-style").html()),$("div#pocs",i).remove(),C(i,"patent"),a(i),$("a[href='/patents']",i).remove(),$("div#footer_table",i).remove(),$("body *",i).each(b),$("body",i).prepend($("script#page-header").html()),$("div.viewport-chrome-toolbar div:contains('Application')",i).each(function(a){$(this).on("click",{index:a},c)}),$("div.viewport-chrome-toolbar div:contains('Grant')",i).each(function(a){$(this).on("click",{index:a},e)}),$("td.patent-bibdata-heading:contains('Also published as') ~ td span.patent-bibdata-value > a",i).off("click",D).on("click",g),$("span.notice-section > a",i).contents().unwrap(),$("table.patent-bibdata td.patent-bibdata-heading:contains('Export')",i).closest("tr").remove(),$("tr.patent-internal-links",i).on("click",d);var j=Td.setupPatentTab(h,i);n.tab("show"),window.scrollTo(0,0),window.focus(),Md.end(1500),window.setTimeout(function(){o.css("visibility","visible")},1e3),f.resolve(j)}_d+=1;var h="patTab_"+_d,i="patent_"+_d,j="gps_patent_"+_d,k=Xd({tab_id:h,tab_content_id:i,tab_name:b}),l=Yd({tab_content_id:i,iframe_id:j,iframe_width:1050,iframe_height:qd}),m=$("script#tab-buttons").html();$("div.tab-pane.active").after(l),$("ul#topTabs li.active").after(k);var n=$("a#"+h);n.find("button.close-tab").on("click",Td.deleteTab),n.append(m);var o=$("iframe#"+j);o.css("visibility","hidden").on("load",g).on("error",c),Md.start(),$("iframe#"+j).attr("src",a)}function d(a){var b=$(a.target);"A"==b.prop("tagName")&&window.setTimeout(function(){window.scrollTo(0,0)},30)}var f=new $.Deferred,g=$("a[data-tabname='"+b+"']");if(0==g.length)c(a,b);else{g.click();var h=g.attr("data-patent");f.resolve(h)}return f.promise()}function A(a){var b=/([A-Z]|[A-Z]\d)$/;return a.replace(b,"")}function B(a,b){function c(){var a=$(this);if(a.get(0)==b.get(0))return!1;var c=a.find(b);if(c.size()>0)return B(a,b),!1;switch(a.prop("tagName")){case"SCRIPT":return;default:a.remove()}}a.children().each(c)}function C(a,b){function c(a){a.preventDefault(),a.stopPropagation();var b=$(this).attr("href"),c=F(a.currentTarget,a.data.$context,a.data.page),d=$("a[data-tabname='Re-"+c.patent_no+"']");0==d.length?y(b+"#c=p"):d.click()}function d(a){a.preventDefault(),a.stopPropagation();var b=$("div.tab-pane.active iframe"),c=$(this).attr("href");w(b,c)}function e(a){a.preventDefault(),a.stopPropagation();var b=$(this).attr("href");window.open(b)}$("a",a).each(function(){var f=$(this).attr("href");if(f)if(ce.some(function(a){return f.search(a)>=0?!0:!1}))$(this).on("click",e);else{var g=f.replace("https","http");g=g.replace("http://www.google.com",""),$(this).attr("href",g);var h=/\/[^\?/]*[\?/]/,i=h.exec(g),j=i?i[0]:"";switch(j){case"/patents/":$(this).removeAttr("onmousedown"),g.search("/patents/related")>=0?$(this).on("click",{$context:a,page:b},c):$(this).on("click",{$context:a,page:b},D);break;case"/search?":g.search("&start=")>=0?$(this).on("click",d):$(this).on("click",E);break;case"/url?":g.search("/www.google.com/patents/")>=0?$(this).on("click",{$context:a,page:b},D):$(this).on("click",{$context:a,page:b},c)}}})}function D(a){a.preventDefault(),a.stopPropagation();var b=F(a.currentTarget,a.data.$context,a.data.page),c=A(b.patent_no);e("In on_click_new_patent_url, make or navigate to patent tab "+c),z(b.patent_url,c)}function E(a){a.preventDefault(),a.stopPropagation();var b=$(this).attr("href"),c=$(this).text(),d=c.split(/[,\s]+/),f="Result",g=[{},{name:"as_drrb_is",value:"q"},{name:"as_ptypeorstatus",value:"0"}];if(b.search("ininventor")>=0){if(d.length>0){var h=d[d.length-1];switch(h.toUpperCase()){case"JR":case"JR.":case"II":case"III":case"IV":f=d[d.length-2];break;default:f=h}}g[0]={name:"as_pinvent",value:c}}else b.search("inassignee")>=0?d.length>0&&(f=d.length>1?d[0]+"...":d[0],g[0]={name:"as_pasgnee",value:c}):e("In on_click_new_search_url, did not match search url");s(b,f,g,void 0)}function F(a,b,c){var d="",e="";switch(c){case"mapped-list":case"favorites-list":var f=$(a,b).closest("div.patent-list-patent"),d=f.attr("data-patent");e=f.find("a.pop1-patent-url").attr("href");break;case"map":var g=$(a,b).closest("div.bib");d=g.attr("data-patent"),e=g.find("a.pop1-patent-url").attr("href");break;case"main":d=$(a,b).closest("a").attr("data-patent"),e="/patents/"+d;break;case"patent":e=$(a,b).attr("href");var h=be.exec(e);d=h?h[1]:"";break;case"search":var i=$(a,b).closest("li.g",b);e=$(i,b).find("cite",b).text().replace(/www.google.com/,"");var h=be.exec(e);d=h?h[1]:"";break;case"related":var j=$(a,b).closest("div.r",b);e=$(j,b).find("cite",b).text().replace(/www.google.com/,"");var h=be.exec(e);d=h?h[1]:"";break;case"related-root":var k=$(a,b).closest("div.metadata",b);e=k.find("a",b).attr("href").replace(/www.google.com/,"");var h=be.exec(e);d=h?h[1]:""}return{patent_url:e,patent_no:d}}function G(a,b,c,d){var e=$("span.btn-map-add",a),f=$("span.btn-favorite-add",a);$("span.btn-map-add, span.btn-favorite-add",a).attr("data-patent",d).on("click",{$context:b,page:c},H),-1!=ke.map.indexOf(d)?e.addClass("show-result-btn"):e.removeClass("show-result-btn"),-1!=ke.favorites.indexOf(d)?f.addClass("show-result-btn"):f.removeClass("show-result-btn")}function H(a){function b(){e("In on_mapping_complete, patentsPlotted: ",pe),Eb(),Fb()}a.preventDefault(),a.stopPropagation();var c=a.data.$context,d=a.data.page,f=$(a.target,c),g=F(a.currentTarget,a.data.$context,d),h=g.patent_no,i=f.hasClass("btn-map-add")?"map":f.hasClass("btn-favorite-add")?"favorites":"";if(f.hasClass("show-result-btn")){switch(i){case"favorites":O(h,f,d);break;case"map":P(h,f,d)}e("In on_click_map_buttons, removing patent "+h+" from "+i+" list")}else switch(I(h,f,"add"),e("In on_click_map_buttons, adding patent "+h+" to "+i+" list"),i){case"favorites":K(h,d);break;case"map":M(h,d,b)}}function I(a,b,c){var d=b.hasClass("btn-map-add")?"btn-map-add":b.hasClass("btn-favorite-add")?"btn-favorite-add":"";J(a,d,c)}function J(a,b,c){function d(a,b){switch(b){case"remove":a.removeClass("show-result-btn");break;case"add":a.addClass("show-result-btn")}}var e=$("div#Map span."+b+"[data-patent='"+a+"']",document);e.length>0&&d(e,c);var f=$("ul.nav-tabs span."+b+"[data-patent='"+a+"']",document);f.length>0&&d(f,c),$("div.tab-pane[id^='result'] iframe, div.tab-pane[id^='related'] iframe").each(function(){$context=$(this).contents();var e=$("span."+b+"[data-patent='"+a+"']",$context);e.length>0&&d(e,c)})}function K(a,b){function c(a,b){function c(b){he[a].title=b[1]?b[1]:"Title not available";var c=b[7]?qb(b[7][0]+("0"+b[7][1]).slice(-2)+("0"+b[7][2]).slice(-2)):"N/A";he[a].pub_date=c,he[a].file_date=b[6]?qb(b[6][0]+("0"+b[6][1]).slice(-2)+("0"+b[6][2]).slice(-2)):b[7]?c:"";var e=b[11].join(", "),f=b[12].join(", ");he[a].inventors=""==e?"Inventors not available":e,he[a].assignee=""==f?"Assignee not available":f,d()}function d(){fe.finishTask(1),e("In getFavoriteBiblioData, for "+a+", got favorite biblio data: ",he[a]),b()}he[a]={};var f=ge[a]?ge[a]:ie[a];f?(he[a].title=f.title,he[a].file_date=f.file_date,he[a].pub_date=f.pub_date,he[a].inventors=f.inventors,he[a].assignee=f.assignee,b()):(fe.initialize("Fetching patent",void 0),fe.startTask(1),L(a,c))}function d(){ke.favorites.push(a);var c=re[a]&&!pe[a]?re[a]:{};if(c){for(link in c.sourcePatentLinks){var d=c.sourcePatentLinks[link],e=d.source.patent_no;if(-1!=ke.map.indexOf(e)&&-1!=ke.deleted.indexOf(a)){c.source=!1,Y("",a,"","undo_delete"),setUndoBUttonState();break}}ob(a,c)}if(pe[a]){var g=d3.select("g.force-patent-marker[data-patent="+a+"]");Qc(g,b)}f(a)}function f(a){var b=he[a],c=ve({patent_no:a});ze.find("div.patent-list-patents").prepend(c);var d=ze.find("div.patent-list-entry[data-patent='"+a+"'] div.patent-list-patent-container"),e=we({patent_no:a,patent_label:A(a),source_patent:a,title:b.title,file_date:b.file_date});d.append(e),G(d,document,"favorites-list",a),Zb(d,a),Yb(d,"favorites-list"),Ub(d,a,"favorites-list"),Rb(d,a,"favorites-list")}a in he?(e("In addFavoritePatent, have "+a+" in favoriteBiblio"),d()):(e("In addFavoritePatent, do not have "+a+" in favoriteBiblio"),c(a,d))}function L(a,b){Md.start(),$.ajax({type:"POST",url:"/patents/related/rpc",headers:{XmlHttpRequest:"2"},contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{m:"metadata",id:a},success:b,dataType:"json"}),Md.end(0)}function M(a,b,c){function d(){e("In on_patent_data_done, added entry for "+a+" to patentBibio"),Md.end(1e3),window.setTimeout(i,500)}function f(){Md.end(0),e("Error getting data in getPatentBiblioData or getRelatedPatentList.")}function g(){function b(a,b){e("In getGooglePatentHTML, request data from Google for "+a);var c="/patents/"+a;$.get(c,b)}function c(a){var b=$("a[data-tabname='"+a+"']");if(b.length>0){var c=b.attr("href");return e("In getPatentDocHTML, tab for patent "+a+" is already open"),$("div"+c+" > iframe").contents()}return void 0}function d(b){var c=$(b).select("body");c.remove("div.patent-description-section");var d=ge[a],g=ub(c),h=$("table.patent-bibdata td.patent-bibdata-heading:contains('Filing date') + td.single-patent-bibdata",c).text(),i=$("table.patent-bibdata td.patent-bibdata-heading:contains('Publication date') + td.single-patent-bibdata",c).text(),j=$("div.abstract",c).text();d.title=""==g.title?"Title not available":g.title,d.inventors=""==g.inventors?"Inventors not available":g.inventors,d.assignee=""==g.assignee?"Assignee not available":g.assignee,d.shortAssignee=""==g.shortAssignee?"Not available":g.shortAssignee,d["abstract"]=""==j?"Not available":j,d.pub_date=""==i?"N/A":i,d.file_date=""==h?"N/A"==i?"":i:h;var k=$("a#backward-citations ~ table.patent-data-table td.citation-patent a",c),l=new Array(k.length);k.each(function(a){l[a]=this.textContent});var m=$("a#forward-citations ~ table.patent-data-table td.citation-patent a",c),n=new Array(m.length);m.each(function(a){n[a]=this.textContent}),d.cited_patents=l,d.citing_patents=n,fe.finishTask(1),f.resolve(),e("In getPatentBiblioData: finished parsing biblio data from Google patent document for patent "+a+".")}var f=$.Deferred(),g=c(a);return g?d(g):b(a,d),f.promise()}function h(){function b(b){if(e("In on_complete_related_metadata_post, metadata returned from /related/rpc for patent "+a+" is ",b),b[10]&&b[10][1]){var g=b[10][1];searchTerms=g.slice(0,3).join(" "),fe.finishTask(1),$.ajax({type:"POST",url:"/patents/related/rpc",headers:{XmlHttpRequest:"2"},contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{m:"search",q:searchTerms,c:"p",start:"",end:encodeURIComponent(d(new Date)),page:"0",pid:a},success:c,dataType:"json"})}else fe.finishTask(1),f.resolve()}function c(b){if(e("In on_complete_related_patents_post, related patent data returned from /related/rpc for patent "+a+" is ",b),ge[a].related_patents=[],b[5]){for(var c=b[5],d=0;d<c.length;d++){var g=c[d][7];if(g.length>0){var h=g[0][0];ge[a].related_patents.push(h)}}fe.finishTask(1),f.resolve(),e("In getRelatedPatentList: finished querying /related/rpc for Google related patents for patent "+a+".")}else fe.finishTask(1),f.resolve()}function d(a){var b=a.getDate().toString();b=b.length<2?"0"+b:b;var c=(a.getMonth()+1).toString();c=c.length<2?"0"+c:c;var d=a.getFullYear().toString();return c+"/"+b+"/"+d}var f=$.Deferred();return $.ajax({type:"POST",url:"/patents/related/rpc",headers:{XmlHttpRequest:"2"},contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{m:"metadata",id:a},success:b,dataType:"json"}),f.promise()}function i(){e("In mapSourcePatent, patentLists: ",ke,"; patentBiblio: ",ge),e("In mapSourcePatent, starting to assemble data for mapping at "+(new Date-ee)/1e3),j(),k()}function j(){W(a,b,"new"),Pb(a),e("In processSourcePatent, adding the source node for "+a+" to the force map"),Oc()}function k(){function b(){function b(b,c){var d=ld(c);d&&(V(a,d,h,b),e("In mapNewTargetPatents, adding queried EPO data for EPO query list "+(b+1)+" with "+d.length+" "+h[b].type+" patents to the force map"),Oc()),fe.finishTask(1)}var h=n(a,d,f,g);e("In mapNewTargetPatents, epoQueryLists: ",h),h.length>0?(fe.initialize("Fetching patents",c),fe.startTask(h.length)):c();for(var i=0;i<h.length;i++){var j=h[i].list;kd(j,b.bind(void 0,i))}}var d=l(a,ge[a].cited_patents,"cited"),f=l(a,ge[a].citing_patents,"citing"),g=l(a,ge[a].related_patents,"related");nb(a,b)}function l(a,b,c){for(var d=[],e=0;e<b.length;e++){var f=b[e];if(ie[f]){var g=re[a],h=a+f+c;h in g.targetPatentLinks||Z(a,f,c,h)}else d.push(f)}return d}function m(a,b){for(var c=15,d=Math.floor(a.length/c),e=[],f=0;d>f;f++){var g=a.slice(f*c,(f+1)*c);e.push({list:N(g),type:b,done:!1})}if(d*c<a.length){var g=a.slice(d*c);e.push({list:N(g),type:b,done:!1})}return e}function n(a,b,c,d){return[].concat(m(b,"cited"),m(c,"citing"),m(d,"related"))}-1==ke.map.indexOf(a)?($("a[href='#Map']").click(),_.isEmpty(pe)&&0==ke.deleted.length&&(Jd.initialize(),Mb(),Hb()),ee=new Date,e("In addMapPatent, started mapping process"),a in ge?(e("In addMapPatent, have "+a+" in patentBiblio"),i()):(e("In addMapPatent, do not have "+a+" in patentBiblio"),ge[a]={},fe.initialize("Fetching patent",void 0),fe.startTask(3),Md.start(),$.when(g(),h()).done(d).fail(f))):c&&c()}function N(a){function b(a){var b=de.exec(a);if(b){var c=b[1],d=b[2],f=b[3],g=b[4],h=b[5],i=!1,j=[];switch(c){case"US":switch(11==f.length&&"0"==f[4]&&(f=f.slice(0,4)+f.slice(5),i=!0),d){case"D":f+="S";break;case"PP":f+="P",d="";break;case"RE":f+="E"}break;case"WO":switch(intDoc=parseInt(f.slice(4,10)),intYear=parseInt(f.slice(0,4)),!0){case 2002>=intYear:1e5>intDoc&&(f=f.slice(0,4)+f.slice(5))}switch(!0){case 2003>=intYear:f=f.slice(2)}}return j.push(c+d+f+g+(h?"."+h:"")),i&&j.push(c+d+f+g+"P"+(h?"."+h:"")),j}return e("In formatEPOPatentNumber, could not match '"+a+"'. Skipping..."),""}for(var c="",d=0;d<a.length;d++){var f=a[d],g=b(f);if(""!=g)for(var h=0;h<g.length;h++){c=c+","+g[h];var i=g[h].replace(/\./g,"");je[i]=f}}return c}function O(a,b,c){if(Q("favorites",ze,a,b),pe[a])if("favorites-list"==c)Xb(a);else{var d=d3.select("g.force-patent-marker[data-patent="+a+"]");Qc(d,c)}}function P(a,b,c){var d=pe[a];if(gb(d,null),d.source=!1,Dc(),Bc(),Pe.start(),Q("map",ye,a,b),"mapped-list"==c)Xb(a);else{var e=d3.select("g.force-patent-marker[data-patent="+a+"]");Qc(e,c)}}function Q(a,b,c,d){I(c,d,"remove"),b.find("div.patent-list-entry[data-patent='"+c+"']").remove(),ke[a].splice(ke[a].indexOf(c),1)}function R(a,b,c){this.patent_no=a,this.source=b,this.biblio=c,this.label=A(a),this.key=a,this.plotLinks=0,this.date=se.parse(this.biblio.file_date),this.x_fix=Jd.xForceScale(this.date),this.plotX=0,this.plotY=0,this.updatePlotCoord=function(){this.plotX=Jd.xForceToPlotScale(this.x),this.plotY=Jd.yForceToPlotScale(this.y)},this.drag=!1,this.sourcePatentLinks={},this.targetPatentLinks={},this.targetPatentLinksList=[],this.biblioNode={},this.biblioLink={},this.markerRadius=7,this.sortOrder=3}function S(a,b){this.patent_no=a,this.label=A(a),this.biblio=b,this.key=a,this.plotX=0,this.plotY=0,this.updatePlotCoord=function(){this.plotX=Jd.xForceToPlotScale(this.x),this.plotY=Jd.yForceToPlotScale(this.y)},this.drag=!1,this.displayed=!1,this.pinned=!1,this.mouseleave=!1,this.transition=!1,this.detached=!1,this.z_index=0,this.patentNode={},this.biblioLink={}}function T(a,b,c){this.patent_no=a,this.key=a,this.patentNode=b,this.biblioNode=c,this.sortOrder=2}function U(a,b,c,d){this.source=a,this.target=b,this.type=c,this.key=d,this.sortOrder=1}function V(a,b,c,d){c[d].done="true",e("In addEPOPatentDataToForceMap, retrieved biblio data for the following patents"),e(b);for(var f=c[d].type,g=ye.find("div.patent-list-entry[data-patent='"+a+"'] div.patent-list-patent-container"),h=0;h<b.length;h++){var i=b[h];Y(a,i,f,"new"),Ob(g,a,i,f,!1)}}function W(a,b,c){if(re[a]?bb(!0,a):ab(!0,a),ke.map.push(a),pe[a]){var d=d3.select("g.force-patent-marker[data-patent="+a+"]");Qc(d,b)}else db(a);switch(c){case"undo_clear":X(a,"map")}}function X(a,b){var c=ke.cleared,d=c[b].indexOf(a);-1!=d&&c[b].splice(d,1);var e=!0;for(b in c)c[b].length>0&&(e=!1);e&&ke.clearFlag&&(ke.clearFlag=!1)}function Y(a,b,c,d){switch(re[b]||ab(!1,b),d){case"new":pe[b]||-1!=ke.deleted.indexOf(b)||db(b);break;case"undo_delete":case"undo_clear":pe[b]||db(b)}if(""!=a){var e=re[b],f=a+b+c;if(f in e.sourcePatentLinks||Z(a,b,c,f),pe[b]){var g=e.sourcePatentLinks[f];cb(g)}}else{var e=pe[b];if(e)for(f in e.sourcePatentLinks){var h=e.sourcePatentLinks[f],i=h.source.patent_no;-1!=ke.map.indexOf(i)&&cb(h)}}switch(d){case"undo_clear":X(b,"target")}}function Z(a,b,c,d){var e=re[b],f=re[a],g=new U(f,e,c,d);f.targetPatentLinksList.push(d),f.targetPatentLinks[d]=g,e.sourcePatentLinks[d]=g}function ab(a,b){var c=a?ge[b]:ie[b],d=new R(b,a,c),e=new S(b,c),f=new T(b,d,e);d.biblioNode=e,d.biblioLink=f,e.patentNode=d,e.biblioLink=f,re[b]=d}function bb(a,b){var c=a?ge[b]:ie[b],d=re[b];a&&(d.biblio.cited_patents=c.cited_patents,d.biblio.citing_patents=c.citing_patents,d.biblio.related_patents=c.related_patents,d.source=a)}function cb(a){ne.push(a),a.source.plotLinks+=1,a.target.plotLinks+=1}function db(a){var b=re[a];pe[a]=b,delete qe[a],Db(a),Gc(b),le.push(b),me.push(b.biblioNode),oe.push(b.biblioLink)}function eb(a,b,c){function d(){switch(fb(g),lb(g,"delete"),jb(g.biblioNode),kb(g.biblioNode.biblioLink),e(a),f(a),b){case"single":Oc(),g.source?Pe.start():(Pe.start(),Pe.alpha(Math.max(rd.alpha,.06)));break;case"group":}c&&c()}function e(a){var b=ye.find("div.patent-list-patent[data-patent='"+a+"']"),c=b.closest("div.patent-list-citation-container"),d=c.find("div.patent-list-citation-heading");d.each(function(){Qb($(this),"deleted",1),Qb($(this),"mapped",-1)}),b.remove()}function f(a){ze.find("span.btn-hide-add[data-patent='"+a+"']").addClass("make-not-displayed")}rd.alpha=Pe.alpha();var g=d3.select("g.node[data-patent="+a+"]").datum();d3.select("div.bib[data-patent="+a+"] div.pop1-container").classed({"make-displayed":!1}),g.source?gb(g,d):d()}function fb(a){for(linkKey in a.sourcePatentLinks){var b=a.sourcePatentLinks[linkKey],c=b.source;-1!=ke.map.indexOf(c.patent_no)&&(ib(b),0==c.plotLinks)}}function gb(a,b){function c(){arguments.length>0&&fe.finishTask(arguments[0]);for(var b=g[h],f=b.end-1;f>=b.start;f--){var i=e[f];hb(a,i)}Oc(),h>0?(h--,window.setTimeout(c.bind(void 0,1),500)):window.setTimeout(d,500)}function d(){fe.finishTask(1),b&&b()}var e=a.targetPatentLinksList;if(0!=e.length){var f=40,g=pb(e,f),h=g.length-1;h>=0?(fe.initialize("Deleting patents",void 0),fe.startTask(g.length),c()):b&&b()}}function hb(a,b){var c=a.targetPatentLinks[b],d=c.target;d.patent_no in pe&&(ib(c),0!=d.plotLinks||d.source||(lb(d,"unplot"),jb(d.biblioNode),kb(d.biblioLink)))}function ib(a){var b=(a.key,ne.indexOf(a));-1!=b?(ne.splice(b,1),a.source.plotLinks-=1,a.target.plotLinks-=1):e("In deletePLink, tried to delete patentLink that was not on the force map: ",a)}function jb(a){var b=(a.patent_no,me.indexOf(a));-1!=b?me.splice(b,1):e("In deleteBNode, tried to delete biblioNode that was not on the force map: ",a)}function kb(a){var b=(a.patent_no,oe.indexOf(a));-1!=b?oe.splice(b,1):e("In deleteBLink, tried to delete biblioLink that was not on the force map: ",a)}function lb(a,b){var c=a.patent_no,d=le.indexOf(a);if(-1!=d){switch(le.splice(d,1),delete pe[c],b){case"unplot":qe[c]=a;break;case"delete":Cb(c)}if(a.source){var f=$("div.bib[data-patent='"+c+"']").find("span.btn-map-add");Q("map",ye,c,f)}Hc(a)}else e("In deletePNode, tried to delete patentNode that was not on the force map: ",a)}function mb(a,b,c,d){function e(){switch(f(a),ob(a,g),b){case"single":Oc();break;case"group":}if(a in ke.favorites){var c=ze.find("div.patent-list-entry[data-patent='"+a+"'] div.patent-list-patent-container");Zb(c,a)}d&&d()}function f(a){-1!=ke.map.indexOf(a)&&J(a,"btn-map-add","add"),-1!=ke.favorites.indexOf(a)&&J(a,"btn-favorite-add","add")}var g=re[a];g.source?(W(a,"map",c),Pb(a),nb(a,e)):(Y("",a,"",c),e())}function nb(a,b){function c(){arguments.length>0&&fe.finishTask(arguments[0]);for(var b=[],f=k[l],j=f.start;j<f.end;j++){var m=i[j],n=g.targetPatentLinks[m],o=n.target.patent_no,p=n.type;Y(a,o,p,"new"),Ob(h,a,o,p,!1),b.push(o)}Oc(),e("In mapExistingTargetPatents, for source patent "+a+", already have EPO data for "+b.length+" reference patents: ",b),l++,l<k.length?window.setTimeout(c.bind(void 0,1),500):window.setTimeout(d,500)}function d(){fe.finishTask(1),f()}function f(){b&&b()}var g=pe[a],h=ye.find("div.patent-list-entry[data-patent='"+a+"'] div.patent-list-patent-container"),i=g.targetPatentLinksList,j=40,k=pb(i,j);if(k.length>0){var l=0;fe.initialize("Fetching patents",void 0),fe.startTask(k.length),c()}else f()}function ob(a,b){for(link in b.sourcePatentLinks){var c=b.sourcePatentLinks[link],d=c.source.patent_no;if(-1!=ke.map.indexOf(d)){var e=c.type,f=ye.find("div.patent-list-entry[data-patent='"+d+"'] div.patent-list-patent-container");Ob(f,d,a,e,!0)}}}function pb(a,b){var c=[];if(a.length>0){var d=Math.ceil(a.length/b);nnL=Math.floor(a.length/d);for(var e=0;d-1>e;e++)c.push({start:e*nnL,end:(e+1)*nnL});c.push({start:(d-1)*nnL,end:a.length})}return c}function qb(a){return moment.utc(a,"YYYYMMDD").format("MMM D, YYYY")}function rb(a){var b=a.replace(/\s\[\w*\]/g,"");return sb(b)}function sb(a){return a.toLowerCase().replace(/\b\w/g,function(a){return a.toUpperCase()})}function tb(a){var b=["INC","INCORP","LLC","LIMITE","LTD","CO","COMPAN","TECHNO","TECH","INDUST","IND","NV"];switch(a.slice(0,4).toUpperCase()){case"":return"No assignee";case"UNIV":switch(a.slice(0,10).toUpperCase()){case"UNIVERSITY":return a.slice(0,20);default:return a.slice(0,12)}default:var c=a.split(/[,\s]+/);if(1==c.length)return c[0].slice(0,7);var d=c[1].slice(0,6).toUpperCase();return-1==b.indexOf(d)?c[0].slice(0,7)+" "+c[1].slice(0,7):c[0].slice(0,7)}}function ub(a){var b=$("span.patent-title",a).text();e("In getTIA, got title "+(new Date-ee)/1e3);var c=[],d=[],f=[];$("table.patent-bibdata td.patent-bibdata-heading:contains('Inventors') + td span.patent-bibdata-value a",a).each(function(){var a=$(this).text();a=sb(a),c.push(a)}),e("In getTIA, got inventors "+(new Date-ee)/1e3),$("table.patent-bibdata td.patent-bibdata-heading:contains('Assignee') + td span.patent-bibdata-value a",a).each(function(){var a=$(this).text();a=sb(a);var b=a.replace(/S A$|Sa$/,"SA").replace(/Llc/,"LLC").replace(/A G$|Ag$/,"AG").replace(/G M B H$|Gmbh$/,"GmbH");d.push(b),f.push(tb(b))}),0==d.length&&$("table.patent-bibdata td.patent-bibdata-heading:contains('Applicant') + td span.patent-bibdata-value a",a).each(function(){var a=$(this).text(),b=a.replace(/S A$|Sa$/,"SA").replace(/Llc/,"LLC").replace(/A G$|Ag$/,"AG").replace(/G M B H$|Gmbh$/,"GmbH");d.push(b),f.push(tb(b))});var g=c.join(", "),h=d.join(", "),i=f.sort().join(" ");return e("In getTIA, got assignee "+(new Date-ee)/1e3),{title:b,inventors:g,assignee:h,shortAssignee:i}}function vb(){function a(){if(this.runningTimeout&&window.clearTimeout(this.runningTimeout),this.maxCount>this.doneCount)var a=2e3*(this.maxCount-this.doneCount);else var a=2e3;this.runningTimeout=window.setTimeout(b.bind(this),a)}function b(){$("div.status-line").removeClass("make-visible"),this.runningTimeout=void 0,this.doneCount!=this.maxCount&&e("In TaskTracker, "+(this.maxCount-this.doneCount)+" tasks failed to complete"),this.callback&&this.callback()}function c(){$("span.status-line-queries").text(d.call(this))}function d(){return" "+this.doneCount+"/"+this.maxCount+" tasks done"}this.initialize=function(a,c){this.runningTimeout&&this.maxCount==this.doneCount&&(window.clearTimeout(this.runningTimeout),b.call(this)),$("span.status-line-type").text(a+" "),this.doneCount=0,this.maxCount=0,this.runningTimeout=void 0,this.callback=c,this.error=!1,e("In taskTracker, initializing task "+a)},this.startTask=function(b){this.error||(this.maxCount+=b,c.call(this),this.runningTimeout||$("div.status-line").addClass("make-visible"),a.call(this),e("In taskTracker, starting "+b+" tasks"))},this.finishTask=function(b){this.error||(this.doneCount+b<=this.maxCount?this.doneCount+=b:(this.doneCount=this.maxCount,e("In taskTracker.finishTask, warning: more tasks finishing than were started")),c.call(this),a.call(this),e("In taskTracker, finished "+b+" task; "+this.doneCount+"/"+this.maxCount+" complete"))},this.reportError=function(a){this.error=!0,this.runningTimeout&&(window.clearTimeout(this.runningTimeout),b.call(this)),$("span.status-line-type").text(a),$("span.status-line-queries").text(""),$("div.status-line").addClass("make-visible")}}function wb(a){a.stopImmediatePropagation(),Wd.clearError(),13==a.keyCode&&($(this).off("keydown"),yb(a))}function xb(a){a.stopImmediatePropagation(),13==a.keyCode&&$(this).on("keydown",wb)}function yb(){function a(a){a.url?Wd.getPatent(a.url,a.label,b):(Wd.showError(a.error),c(!1))}function b(a){function b(){var a=arguments[0],b=$("a[data-tabname='"+a+"']");b.click(),c(!1)}window.setTimeout(b.bind(void 0,a),1e3)}function c(a){var b=$("span.btn-go");a?b.addClass("disabled"):b.removeClass("disabled")}$("input.input-patent").on("keydown",wb);var d=$("input.input-patent").val();e("In on-click_go_btn, input text is "+d),c(!0),Wd.validatePatent(d,a)}function zb(){function a(a){function c(){var a=arguments[0],c=$("a[data-tabname='"+a+"']");c.click(),b(!1)}window.setTimeout(c.bind(void 0,a),1e3)}function b(a){$("button.btn-random").prop("disabled",a)}b(!0),Vd.mapRandomPatent(a)}function Ab(){function a(a){a.error?(e("In on_click_fun_button, patent "+f+" was not found on Google patents"),c(!1)):Wd.getPatent(g,f,b)}function b(a){function b(){var a=arguments[0],b=$("a[data-tabname='"+a+"']");b.click(),c(!1)}window.setTimeout(b.bind(void 0,a),1e3)}function c(a){$("button.btn-fun").prop("disabled",a)}c(!0);var d=Math.floor(te.length*Math.random()),f=te[d],g="/patents/"+f;r(g,a)}function Bb(){function a(){Eb(),Fb()}if(ke.clearFlag)Jb(a);else{var b=ke.deleted.slice(-1)[0];mb(b,"single","undo_delete",a)}}function Cb(a){ke.deleted.push(a)}function Db(a){var b=ke.deleted.indexOf(a);-1!=b&&ke.deleted.splice(b,1)}function Eb(a){arguments.length>0?$("button.btn-undo").prop("disabled",a):0==ke.deleted.length?$("button.btn-undo").prop("disabled",!0):$("button.btn-undo").prop("disabled",!1)}function Fb(a){arguments.length>0?$("button.btn-clear").prop("disabled",a):_.isEmpty(pe)?$("button.btn-clear").prop("disabled",!0):$("button.btn-clear").prop("disabled",!1)}function Gb(){function a(){if(d>0){d--;var e=c[d];eb(e,"single",a)}else b()}function b(){for(patent_no in pe)eb(patent_no,"group",void 0),ke.cleared.target.unshift(patent_no);Oc(),Hb(),ke.clearFlag=!0,Eb(!1)}Fb(!0),Ib();var c=ke.cleared.map,d=c.length;a()}function Hb(){ke.deleted=[]}function Ib(){var a=ke.cleared;a.deleted=ke.deleted.slice(),a.map=ke.map.slice()}function Jb(a){function b(){Mb(),a()}Eb(!0),Kb(),Jd.initialize(),Lb(b)}function Kb(){ke.deleted=ke.cleared.deleted
}function Lb(a){function b(){var a=e.length;if(a>0){var d=e[0];mb(d,"group","undo_clear",b)}else Oc(),c()}function c(){var b=d.length;if(b>0){var e=d[0];b>1?mb(e,"single","undo_clear",c):mb(e,"single","undo_clear",a)}else a()}var d=ke.cleared.map,e=ke.cleared.target;b()}function Mb(){var a=ke.cleared;a.map=[],a.target=[],a.deleted=[],ke.clearFlag=!1}function Nb(a){a.preventDefault()}function Ob(a,b,c,d,e){var f=a.find("div.patent-list-"+d+"-heading");if(c in pe){Qb(f,"mapped",1),e&&Qb(f,"deleted",-1);var g=a.find("div.patent-list-"+d+"-patents div.patent-list-subpatent-container"),h=ie[c],i=we({patent_no:c,patent_label:A(c),source_patent:b,title:h.title,file_date:h.file_date});g.append(i);var j=g.find("div.patent-list-patent[data-patent='"+c+"']");G(j,document,"mapped-list",c),Zb(j,c),Yb(j,"mapped-list"),Ub(j,c,"mapped-list"),Rb(j,c,"mapped-list")}else Qb(f,"deleted",1)}function Pb(a){function b(){var a=$(this),b=a.closest("div.patent-list-entry"),c=b.closest("div.patent-list-patents"),d=b.find("div.patent-list-references");a.hasClass("patent-list-dropup-arrow")?(a.removeClass("patent-list-dropup-arrow"),d.removeClass("make-displayed-flex"),c.css("min-height","0px")):(a.addClass("patent-list-dropup-arrow"),d.addClass("make-displayed-flex"),c.css("min-height","118px"))}function c(){var a=$(this),b=a.closest("div.patent-list-references"),c=b.closest("div.patent-list-patents"),d=c.css("height"),e=parseInt(d.slice(0,d.length-2)),f=(b.attr("data-patent"),b.attr("data-citation-type"),b.find("div.patent-list-subpatent-container"));a.hasClass("citation-list-dropup-arrow")?(a.removeClass("citation-list-dropup-arrow"),f.removeClass("make-displayed-flex"),b.css("height","25px"),c.css("height",e-47+"px")):(a.addClass("citation-list-dropup-arrow"),f.addClass("make-displayed-flex"),b.css("height","72px"),c.css("height",e+47+"px"))}var d=ge[a],e=ue({patent_no:a});ye.find("div.patent-list-patents").prepend(e);var f=ye.find("div.patent-list-entry[data-patent='"+a+"']"),g=f.find("div.patent-list-patent-container"),h=we({patent_no:a,patent_label:A(a),source_patent:a,title:d.title,file_date:d.file_date});g.append(h),nCited=d.cited_patents.length,nCiting=d.citing_patents.length,nRelated=d.related_patents.length;var i=xe({patent_no:a,citation_type:"cited",citation_no:nCited,citation_heading:"Cited patents"}),j=xe({patent_no:a,citation_type:"citing",citation_no:nCiting,citation_heading:"Citing patents"}),k=xe({patent_no:a,citation_type:"related",citation_no:nRelated,citation_heading:"Related patents - Google"});g.append(i),g.append(j),g.append(k),f.find("div.patent-list-dropdown-arrow").on("click",b),g.find("div.citation-list-dropdown-arrow").on("click",c),G(g,document,"mapped-list",a),Zb(g,a),Yb(g,"mapped-list"),Ub(g,a,"mapped-list"),Rb(g,a,"mapped-list")}function Qb(a,b,c){switch(b){case"mapped":var d=a.find("span.patent-list-citation-mapped");break;case"deleted":var d=a.find("span.patent-list-citation-deleted")}var e=parseInt(d.text())+c;d.text(e.toString())}function Rb(a,b,c){a.find("div.patent-list-fullview-button").on("mouseover",{patent_no:b,page_type:c},Sb).on("mouseout",{patent_no:b,page_type:c},Tb)}function Sb(a){function b(a){var b=ld(a);if(fe.finishTask(1),d.attr("data-querying","false"),b){var g=ie[f];g?(e("In on_mouseover_fullview_button, got EPO API for patent "+f),c(f,g)):e("In on_mouseover_fullview_button, no data in epoBiblio for patent "+f)}else e("In on_mouseover_fullview_button, failed to get EPO data for patent "+f)}function c(a,b){var c=Oe({patent_no:a,patent_label:A(a),file_date:b.file_date,pub_date:b.pub_date,title:b.title,inventors:b.inventors,assignee:b.assignee,"abstract":b.abstract}),e=d.find("div.patent-list-fullview-container").html(c),f=e.offset(),g=e.find("div.pop1-container").addClass("pop1-in-patent-list");g.css("top",f.top-3+"px").css("left",f.left-td.w-12+"px"),g.find("div.pop1-top-capture").remove(),g.find("div.pop1-buttons").remove(),g.find("div.pop1-top-btns").remove(),g.find("div.pop1-inventors").addClass("make-displayed"),g.find("div.pop1-abstract").addClass("make-displayed")}var d=$(this);if("true"!=d.attr("data-querying")){var f=a.data.patent_no,g=ge[f]?ge[f]:ie[f]?ie[f]:void 0;if(g)c(f,g);else{var h=N([f]);d.attr("data-querying","true"),fe.initialize("Fetching additional data",void 0),fe.startTask(1),kd(h,b)}}}function Tb(a){a.data.patent_no;$(this).find("div.pop1-container").remove()}function Ub(a,b,c){a.hasClass("patent-list-patent")?a.on("mouseover",{patent_no:b,page_type:c},Vb).on("mouseout",{patent_no:b,page_type:c},Wb):a.find("div.patent-list-patent").on("mouseover",{patent_no:b,page_type:c},Vb).on("mouseout",{patent_no:b,page_type:c},Wb)}function Vb(a){var b=a.data.patent_no,c=a.data.page_type;if(pe[b]){rc(b);var d=d3.select("g.force-patent-marker[data-patent="+b+"]");Qc(d,c)}}function Wb(a){var b=a.data.patent_no;Xb(b)}function Xb(a){if(pe[a]){sc(a);var b=d3.select("g.force-patent-marker[data-patent="+a+"]");Qc(b,"map")}}function Yb(a,b){$("a.pop1-patent-url",a).on("click",{$context:a,page:b},D)}function Zb(a,b){var c=a.find("span.btn-hide-add");b in pe?c.on("click",{patent_no:b},$b):c.addClass("make-not-displayed")}function $b(a){function b(){Eb(),Fb()}$(this).addClass("make-not-displayed"),eb(a.data.patent_no,"single",b)}function _b(a){a.drag||d3.event.stopPropagation(),rd.alpha=Pe.alpha(),Pe.stop();var b=d3.select(this).attr("data-patent");Ae&&Ae.divBib.attr("data-patent")!=b&&(qc(Ae.divBib),gc(Ae.divBib)),d3.select("text.node-label[data-patent="+b+"]").classed({"visited-label":!0});var c=d3.select("div.bib[data-patent="+b+"]"),d=c.select("div.pop1-container"),e=c.select("g.pop1-marker");if(!c.datum().pinned){var f=Gd.select("line.biblio-link[data-patent="+b+"]");c.call(Nc),f.call(Lc),d.classed({"make-displayed":!0}),f.classed({"make-displayed":!0}),c.select("svg.pop1-arrow-circle").classed({"make-displayed":!0}),Ke=Ie.filter(ac),Le=Je.filter(function(a){return a.biblioNode.displayed})}Ae={divBib:c,divPop:d,gMarker:e},ec(c)}function ac(a){return a.displayed=d3.select(this).select("div.pop1-container.make-displayed").size()>0,a.displayed}function bc(){}function cc(a){a.drag||d3.event.stopPropagation()}function dc(){var a=d3.select(this);qc(a),Ae&&Ae.divBib.datum().patent_no!=a.datum().patent_no&&gc(Ae.divBib),a.style("z-index")!=yd.zMax+1&&ec(a)}function ec(a){var b=a.attr("data-patent");a.style({"z-index":yd.zMax+1}),"normal"==yd.mouse&&a.select("div.pop1-buttons").classed({"make-visible":!0}),rc(b)}function fc(){var a=d3.select(this);"normal"==yd.mouse||a.datum().pinned?a.datum().runningTimeout=window.setTimeout(gc.bind(this,a),500):a.select("div.pop1-buttons").classed({"make-visible":!1})}function gc(a){a.datum().runningTimeout=void 0;var b=a.attr("data-patent");a.datum().pinned||(a.datum().transition||(a.select("div.pop1-container").classed({"make-displayed":!1}),Gd.select("line.biblio-link[data-patent="+b+"]").classed({"make-displayed":!1}),a.select("svg.pop1-arrow-circle").classed({"make-displayed":!1})),Ke=Ie.filter(ac),Le=Je.filter(function(a){return a.biblioNode.displayed})),Ae=void 0,a.style({"z-index":function(a){return a.z_index}}),a.select("div.pop1-buttons").classed({"make-visible":!1}),sc(b)}function hc(){var a=d3.event.target;if(Ae&&(a==Fd.node()||a==Bd.node())){var b=Ae.divBib;switch(yd.mouse){case"transparent":$(b.node()).off("mouseleave.biblio"),$(b.node()).off("mouseenter.biblio"),Ae.divPop.classed({"pointer-events-none":!1}),Ae.gMarker.classed({"pointer-events-none":!1});var c=document.elementFromPoint(d3.event.clientX,d3.event.clientY);Ae.divPop.classed({"pointer-events-none":!0}),Ae.gMarker.classed({"pointer-events-none":!0}),$(b.node()).on("mouseleave.biblio",fc),$(b.node()).on("mouseenter.biblio",dc),(c==Fd.node()||c==Bd.node())&&gc(b);break;case"normal":b.datum().runningTimeout||gc(b)}return void(0==yd.transition&&Pe.alpha(Math.max(rd.alpha,.06)))}!d3.event.relatedTarget||a!=Fd.node()&&a!=Bd.node()||"normal"!=yd.mouse||0!=yd.transition||Pe.alpha(Math.max(rd.alpha,.06))}function ic(){d3.event.data={$context:document,page:"map"},D.call(this,d3.event)}function jc(){E.call(this,d3.event)}function kc(){d3.event.stopPropagation()}function lc(){var a=d3.select(this),b=a.attr("data-patent"),c=d3.select("div.bib[data-patent="+b+"]");c.on("mousedown.drag",null),a.classed({"make-opaque":!0})}function mc(){var a=d3.select(this),b=a.attr("data-patent"),c=d3.select("div.bib[data-patent="+b+"]");c.call(Se),a.classed({"make-opaque":!1})}function nc(){d3.event.stopPropagation(),d3.event.preventDefault(),e("Hello from on_click_top_buttons_biblio. Event is ",d3.event);var a=d3.select(this).attr("data-patent"),b=d3.select(d3.event.target);switch(!0){case b.classed("pop1-full-btn"):var c=d3.select("div.pop1-container[data-patent="+a+"]");c.selectAll("div.pop1-inventors, div.pop1-abstract").classed({"make-displayed":!0}),d3.select(this).select("g.pop1-close").classed({"make-not-displayed":!1}),d3.select(this).select("g.pop1-full").classed({"make-not-displayed":!0});break;case b.classed("pop1-close-btn"):d3.select(this).select("g.pop1-full").classed({"make-not-displayed":!1}),d3.select(this).select("g.pop1-close").classed({"make-not-displayed":!0});var c=d3.select("div.pop1-container[data-patent="+a+"]");c.selectAll("div.pop1-inventors, div.pop1-abstract").classed({"make-displayed":!1});break;case b.classed("pop1-front-btn"):yd.zMax+=1,d3.select(this).datum().z_index=yd.zMax;break;case b.classed("pop1-back-btn"):yd.zMin-=1,d3.select(this).datum().z_index=yd.zMin}}function oc(){function a(){Eb(),Fb()}var b=d3.select(this).classed({"make-not-displayed":!0}),c=b.attr("data-patent");eb(c,"single",a)}function pc(a){function b(){a.mouseleave=!tc(f,g),!a.mouseleave&&a.transition&&(h=window.setTimeout(b,50))}function c(){window.clearTimeout(h);var b=d3.select(this);a.mouseleave?(a.mouseleave=!1,b.transition().duration(1e3*yd.opacityTime).style({opacity:0}).each("end",d)):(a.transition=!1,yd.transition-=1,0==yd.transition&&Pe.alpha(Math.max(rd.alpha,.06))),$(b.node()).off("mousemove.transition")}function d(){a.transition=!1,yd.transition-=1;var b=d3.select(this);b.style("z-index")!=a.z_index?(qc(b),gc(b)):(b.select("div.pop1-container").classed({"make-displayed":!1}),Gd.select("line.biblio-link[data-patent="+a.patent_no+"]").classed({"make-displayed":!1}),b.select("svg.pop1-arrow-circle").classed({"make-displayed":!1})),b.style({opacity:1}),0==yd.transition&&Pe.alpha(Math.max(rd.alpha,.06))}function e(a){$.extend(g,{x:a.clientX,y:a.clientY})}var f=d3.select("div.bib[data-patent="+a.patent_no+"]"),g={};if($.extend(g,{x:d3.event.clientX,y:d3.event.clientY}),a.pinned){rd.alpha=Pe.alpha(),Pe.stop(),$(f.node()).on("mousemove.transition",e),wc(f),a.x=a.patentNode.x,a.y=a.patentNode.y,a.updatePlotCoord(),a.transition=!0,yd.transition+=1,f.transition().ease("linear").duration(1e3*yd.transformTime).style({"-webkit-transform":"matrix(1,0,0,1,"+a.plotX+","+a.plotY+")",transform:"matrix(1,0,0,1,"+a.plotX+","+a.plotY+")"}).each("end",c),d3.select("line.biblio-link[data-patent="+a.patent_no+"]").transition().ease("linear").duration(1e3*yd.transformTime).attr({x2:a.plotX,y2:a.plotY});var h=window.setTimeout(b,50)}else uc(f),vc(f)}function qc(a){a.datum().runningTimeout&&(window.clearTimeout(a.datum().runningTimeout),a.datum().runningTimeout=void 0)}function rc(a){He.filter(function(b){return b.source.patent_no==a||b.target.patent_no==a}).style({"stroke-width":function(b){return b.source.patent_no==a?"3px":"4px"}}),Je.filter(function(b){return b.patentNode.patent_no==a}).style({"stroke-width":"3px"})}function sc(a){He.filter(function(b){return b.source.patent_no==a||b.target.patent_no==a}).style({"stroke-width":"1px"}),Je.filter(function(b){return b.patentNode.patent_no==a}).style({"stroke-width":"1px"})}function tc(a,b){var c=document.elementFromPoint(b.x,b.y),d=$(a.node()).find(c);return d.size()>0}function uc(a){a.datum().pinned=!0,a.datum().detached=!1,a.select("span.btn-pin-add").classed({"btn-pin-add-display":!0,"show-result-btn":!0}),a.select("path.pop1-arrow").classed({"make-hidden":!0}),a.select("circle.pop1-marker").classed({"ghost-marker":!1})}function vc(a){a.select("div.pop1-top-capture").classed({"make-not-displayed":!0}),a.select("svg.pop1-arrow-circle").classed({"make-displayed":!1})}function wc(a){a.datum().pinned=!1,a.datum().detached=!1,a.select("span.btn-pin-add").classed({"btn-pin-add-display":!1,"show-result-btn":!1}),a.select("svg.pop1-arrow-circle").classed({"make-displayed":!0}),a.select("div.pop1-top-capture").classed({"make-not-displayed":!1}),a.select("path.pop1-arrow").classed({"make-hidden":!1}),a.select("circle.pop1-marker").classed({"ghost-marker":!1})}function xc(a){a.datum().pinned=!1,a.datum().detached=!0,a.select("span.btn-pin-add").classed({"btn-pin-add-display":!1,"show-result-btn":!1}),a.select("svg.pop1-arrow-circle").classed({"make-displayed":!0}),a.select("div.pop1-top-capture").classed({"make-not-displayed":!1}),a.select("path.pop1-arrow").classed({"make-hidden":!1}),a.select("circle.pop1-marker").classed({"ghost-marker":!0})}function yc(a){var b=a.append("svg:svg").classed({"pop1-arrow-circle":!0}).attr({"data-patent":function(a){return a.patent_no}});b.append("svg:path").classed({"pop1-arrow":!0}).attr({d:"M 0,0 L 0,8 8,0 z",transform:"translate(12, 12) rotate(45)"});var c=b.append("svg:g").classed({"pop1-marker":!0}).attr({transform:"translate(12, 12)"});c.append("svg:rect").attr({x:"-7px",y:"0px",width:"14px",height:"9px"}),c.append("svg:circle").classed({"pop1-marker":!0}).attr({r:function(a){return a.patentNode.markerRadius},cx:"0px",cy:"0px"})}function zc(a){var b=a.select("div.pop1-top-btns").append("svg:svg").classed({"pop1-top-btns-svg":!0}).attr({width:"62px",height:"22px"}),c=b.append("svg:g").classed({"pop1-front":!0}).attr({"clip-path":"url(#leftBtn)"});c.append("svg:title").text("Bring to front"),c.append("svg:rect").classed({"pop1-top-btn":!0,"pop1-front-btn":!0}).attr({x:"-10px",y:"-10px",rx:"7px",ry:"7px",width:"20px",height:"20px"}),c.append("svg:rect").classed({"pop1-front-back-unfilled":!0}).attr({x:"-5px",y:"-5px",width:"7px",height:"7px"}),c.append("svg:rect").classed({"pop1-front-back-filled":!0}).attr({x:"-2px",y:"-2px",width:"7px",height:"7px"});var d=b.append("svg:g").classed({"pop1-back":!0}).attr({"clip-path":"url(#midBtn)"});d.append("svg:title").text("Send to back"),d.append("svg:rect").classed({"pop1-top-btn":!0,"pop1-back-btn":!0}).attr({x:"-10px",y:"-10px",rx:"7px",ry:"7px",width:"20px",height:"20px"}),d.append("svg:rect").classed({"pop1-front-back-filled":!0}).attr({x:"-5px",y:"-5px",width:"7px",height:"7px"}),d.append("svg:rect").classed({"pop1-front-back-unfilled":!0}).attr({x:"-3px",y:"-3px",width:"8px",height:"8px"});var e=b.append("svg:g").classed({"pop1-full":!0}).attr({"clip-path":"url(#rightBtn)"});e.append("svg:title").text("Full view"),e.append("svg:rect").classed({"pop1-top-btn":!0,"pop1-full-btn":!0}).attr({x:"-10px",y:"-10px",rx:"7px",ry:"7px",width:"20px",height:"20px"}),e.append("svg:rect").classed({"pop1-full-rect":!0}).attr({x:"-5px",y:"-4px",width:"10px",height:"8px"});var f=b.append("svg:g").classed({"pop1-close":!0,"make-not-displayed":!0}).attr({"clip-path":"url(#rightBtn)"});f.append("svg:title").text("Popup view"),f.append("svg:rect").classed({"pop1-top-btn":!0,"pop1-close-btn":!0}).attr({x:"-10px",y:"-10px",rx:"7px",ry:"7px",width:"20px",height:"20px"}),f.append("svg:line").classed({"pop1-close-x1":!0}).attr({x1:"-8px",y1:"0px",x2:"8px",y2:"0px"}),f.append("svg:line").classed({"pop1-close-x2":!0}).attr({x1:"-8px",y1:"0px",x2:"8px",y2:"0px"})}function Ac(a,b,c){this.assignee=a,this.legendColor=b,this.patentCount=c}function Bc(){Ge=Cd.selectAll("g.node"),Ge.each(Cc)}function Cc(a){var b=a.biblio.shortAssignee,c=Fe[b],d=Ee.indexOf(c),e=-1!=d?c.legendColor:Fe.AllOthers.legendColor;d3.select(this).selectAll("circle.force-patent-circle, circle.force-mapped-circle, circle.force-favorite-circle").style({fill:e})}function Dc(){if(De.length>Be){Fe.AllOthers||(Fe.AllOthers=new Ac("Others",zd[0],0)),Fe.AllOthers.patentCount=0;for(var a=Be-1;a<De.length-1;a++){var b=De[a];Fe.AllOthers.patentCount+=b.patentCount}Ee=De.slice(0,Be-1).concat([Fe.AllOthers])}else Ee=De.slice(0,Be);Hd.select("rect.legend-frame").remove();var c=Hd.selectAll("g.legend-entry").data(Ee);c.select("circle.legend-symbol"),c.select("text.legend-text");var d=c.enter().append("svg:g").classed({"legend-entry":!0});if(d.append("svg:circle").classed({"legend-symbol":!0}).attr({r:5}),d.append("svg:text").classed({"legend-text":!0}),c.exit().remove(),c=Hd.selectAll("g.legend-entry"),c.attr({transform:function(a,b){return"translate(0,"+14*b+")"}}),c.selectAll("circle.legend-symbol").style({fill:function(a){return a.legendColor}}),c.selectAll("text.legend-text").attr({transform:"translate(15,0)","dominant-baseline":"middle"}).text(function(a){return a.assignee+" ("+a.patentCount+")"}),De.length>0){var e=Hd.node().getBBox();Hd.insert("svg:rect",":first-child").classed({"legend-frame":!0}).attr({x:"-12",y:"-12",width:e.width+13,height:e.height+9})}}function Ec(a){zd.push(a.legendColor),a.legendColor=""}function Fc(a){a.legendColor=zd.pop()}function Gc(a){var b=a.biblio.assignee,c=a.biblio.shortAssignee,d=Fe[c];d||(d=new Ac(b,"",0),Fe[c]=d,De.push(d)),d.patentCount+=1,De.sort(Ic);var e=De.indexOf(d);if(Ce-1>=e&&""==d.legendColor)if(zd.length>1)Fc(d);else{var f=De[Ce-1];d.legendColor=f.legendColor,f.legendColor=""}}function Hc(a){var b=a.biblio.shortAssignee,c=Fe[b];c.patentCount-=1,De.sort(Ic);var d=De.indexOf(c);if(d>Ce-2&&""!=c.legendColor){var e=De[Ce-2];e.legendColor=c.legendColor,c.legendColor=""}0==c.patentCount&&(De.splice(d,1),""!=c.legendColor&&Ec(c),delete Fe[b])}function Ic(a,b){return a.patentCount<b.patentCount?1:a.patentCount>b.patentCount?-1:"Assignee not available"==a.assignee?1:"Assignee not available"==b.assignee?-1:a.assignee>b.assignee?1:a.assignee<b.assignee?-1:0}function Jc(){d3.select(document).on("keydown.biblio",gd,!0).on("keyup.biblio",hd,!0),Ad.on("click.biblio",dd,!0).on("mousedown.biblio",id,!0).on("mouseup.biblio",jd,!0),Bd.on("mouseover.biblio",hc).on("mousemove.biblio",hc).on("mouseoout.biblio",hc).on("mouseover.shift",fd),Fd.on("click.biblio",dd,!0).on("mousedown.biblio",id,!0).on("mouseup.biblio",jd,!0).call(Jd.zoom),Gd.on("click.biblio",dd,!0).on("mousedown.biblio",id,!0).on("mouseup.biblio",jd,!0)}function Kc(){this.attr("x1",function(a){return a.source.plotX}).attr("y1",function(a){return a.source.plotY}).attr("x2",function(a){return a.target.plotX}).attr("y2",function(a){return a.target.plotY}),this.size()>0&&this.each(Rc)}function Lc(){this.attr("x1",function(a){return a.patentNode.plotX}).attr("y1",function(a){return a.patentNode.plotY}).attr("x2",function(a){return a.biblioNode.plotX}).attr("y2",function(a){return a.biblioNode.plotY+7}),this.size()>0&&this.each(Sc)}function Mc(){this.attr("transform",function(a){return"translate("+a.plotX+","+a.plotY+")"})}function Nc(){this.style({"-webkit-transform":function(a){return"translate("+a.plotX+"px,"+a.plotY+"px)"},transform:function(a){return"translate("+a.plotX+"px,"+a.plotY+"px)"}}),this.classed({"out-of-bounds":function(a){return a.plotY<0||a.plotY>wd.h||a.plotX>wd.w||a.plotX<0}})}function Oc(){e("In updateForceMap, patentNodes: ",le,"; patentLinks: ",ne);var a=Gd.selectAll("line.patent-link").data(Pe.links(),function(a){return a.key});a.enter().append("svg:line").classed({"patent-link":!0}).attr({"data-link-key":function(a){return a.key}}).style({stroke:function(a){switch(a.type){case"cited":return"tomato";case"citing":return"darkgreen";case"related":return"darkblue"}},"stroke-width":"1px"}),a.exit().remove();var b=Gd.selectAll("line.biblio-link").data(oe,function(a){return a.key});b.enter().append("svg:line").classed({"biblio-link":!0}).attr({"data-patent":function(a){return a.patent_no}}),b.exit().remove();var c=Gd.selectAll("g.node").data(Pe.nodes(),function(a){return a.key}),d=c.enter().append("svg:g").classed({node:!0}).attr({"data-patent":function(a){return a.patent_no}}).on("mouseover.biblio",_b).on("mousemove.biblio",cc);c.exit().remove();var f=Ad.selectAll("div.bib").data(Qe.nodes(),function(a){return a.key}),g=f.enter().append("div").classed({bib:!0}).attr({"data-patent":function(a){return a.patent_no}}).style({"z-index":function(a){return a.z_index}});f.exit().remove(),g.each(function(){$(this).on("mouseleave.biblio",fc).on("mouseenter.biblio",dc)}),Gd.selectAll("g.node, line.patent-link, line.biblio-link").sort(function(a,b){return a.sortOrder<b.sortOrder?-1:a.sortOrder>b.sortOrder?1:0}).order(),Tc(),Jd.updateXAxisLimits(),Jd.updateXAxisContent(),Jd.updateForceScaling(),g.html(function(a){return Oe({patent_no:a.patent_no,patent_label:a.label,file_date:a.biblio.file_date,pub_date:a.biblio.pub_date,title:a.biblio.title,inventors:a.biblio.inventors,assignee:a.biblio.assignee,"abstract":a.biblio.abstract})});var h=g.select("div.pop1-container").style({"min-width":Ne.minWidth+"px","max-width":Ne.maxWidth+"px"});h.selectAll("a.pop1-patent-url").on("click.biblio",ic).on("mousedown.biblio",kc),h.selectAll("a.pop1-search-url").on("click.biblio",jc).on("mousedown.biblio",kc),h.select("div.pop1-top-btns").on("click.biblio",nc).on("mouseover.biblio",lc).on("mouseout.biblio",mc),h.each(function(a){G(this,document,"map",a.patent_no)}),h.select("div.pop1-buttons").selectAll("span").on("mousedown.biblio",kc),h.select("span.btn-hide-add").attr({"data-patent":function(a){return a.patent_no}}).on("click.biblio",oc),h.select("span.btn-pin-add").attr({"data-patent":function(a){return a.patent_no}}).on("click.biblio",pc),yc(g),zc(g),ed(g),Ge.size()>0&&Pe.start(),d.each(Pc),d.append("svg:text").text(function(a){return a.label}).classed("node-label",!0).attr({"text-anchor":"middle","dominant-baseline":"middle",transform:"translate(0, "+-Me+")","data-patent":function(a){return a.patent_no}}),Dc(),Ge.each(Cc),d.call(Re),g.call(Se)}function Pc(a){var b=d3.select(this),c=a.patent_no,d=b.append("svg:g").classed({"force-patent-marker":!0}).attr({"data-patent":c});d.append("svg:circle"),Qc(d,"map")}function Qc(a,b){var c=a.datum().patent_no,d=-1!=ke.map.indexOf(c),e=-1!=ke.favorites.indexOf(c),f=d?"mapped":e?"favorite":"normal";switch(f){case"normal":var g=7,h="force-patent-circle";break;case"mapped":var g=10,h="force-mapped-circle",i="#force-mapped-cross-def";break;case"favorite":var g=10,h="force-favorite-circle",i="#force-favorite-heart-def"}a.attr({"data-marker":f}),a.datum().markerRadius=g,a.select("use").remove();var j=a.select("circle").attr({"class":h,r:g});switch(b){case"mapped-list":case"favorites-list":j.style({"stroke-width":"3px"});break;default:j.style({"stroke-width":null})}("mapped"==f||"favorite"==f)&&a.append("svg:use").attr({"xlink:href":i}),d3.select("div.bib[data-patent="+c+"]").select("circle.pop1-marker").attr({r:g})}function Rc(a){"NaN"==d3.select(this).attr("x2")&&e("In updatePLink, link is: ",d3.select(this),a,a.target.plotX,a.target.plotY)}function Sc(a){"NaN"==d3.select(this).attr("x2")&&e("In updateBLink, link is: ",d3.select(this),a,a.patentNode.plotX,a.patentNode.plotY)}function Tc(){Ge=Cd.selectAll("g.node").sort(function(a,b){return a.source<b.source?-1:a.source>b.source?1:0}).order(),Ie=d3.selectAll("div.bib"),Ke=Ie.filter(ac),He=Cd.selectAll("line.patent-link"),Je=Cd.selectAll("line.biblio-link"),Le=Je.filter(function(a){return a.biblioNode.displayed}),Qe.stop()}function Uc(){Ie.filter(function(a){return!(a.pinned||a.patentNode.drag&&"normal"==yd.mouse)}).each(function(a){a.x=a.patentNode.x,a.y=a.patentNode.y,a.updatePlotCoord()}),Ke.call(Nc),Le.call(Lc)}function Vc(){var a=Ie.filter(function(a){return a.drag});a.each(function(a){a.plotX=a.orig_plotX+(a.x-a.orig_x),a.x=Jd.xForceToPlotScale.invert(a.plotX),a.plotY=a.orig_plotY+(a.y-a.orig_y),a.y=Jd.yForceToPlotScale.invert(a.plotY)}),Ke.call(Nc),Le.call(Lc)}function Wc(a){Ge.each(function(b){b.x=b.x+(Math.log(.99)-Math.log(10*a.alpha))/(Math.log(.99)-Math.log(.05))*(b.x_fix-b.x),b.updatePlotCoord()}),Ge.call(Mc),He.call(Kc),Uc(a)}function Xc(a){Ge.each(function(a){a.drag?(a.x=a.orig_x,a.plotY=a.orig_plotY+(a.y-a.orig_y),a.y=Jd.yForceToPlotScale.invert(a.plotY)):(a.x=a.x+.2*(a.x_fix-a.x),a.updatePlotCoord())}),Ge.call(Mc),He.call(Kc),Uc(a)}function Yc(a){a.drag=!0,a.orig_x=a.x,a.orig_y=a.y,a.orig_plotX=a.plotX,a.orig_plotY=a.plotY,Ge.filter(function(b){return b.patent_no!=a.patent_no}).selectAll("circle").classed({"pointer-events-none":!0}),Bd.on("mouseover.biblio",null).on("mousemove.biblio",null).on("mouseoout.biblio",null);var b=Ie.filter(function(b){return b.patent_no!=a.patent_no});b.select("div.pop1-container").classed({"pointer-events-none":!0}),b.select("g.pop1-marker").classed({"pointer-events-none":!0});var c=d3.select(this);$(c.node()).off("mouseenter.biblio"),$(c.node()).off("mouseleave.biblio"),Qe.on("tick",Vc),rd.alpha=Pe.alpha(),Pe.stop()}function Zc(a){var b=1.7*a.patentNode.markerRadius;$c(d3.select(this),a,a.patentNode,b)}function $c(a,b,c,d){c.plotX-b.plotX<d&&b.plotX-c.plotX<d&&c.plotY-b.plotY<d&&b.plotY-c.plotY<d?xc(a):b.pinned||c.plotX-b.plotX<d&&b.plotX-c.plotX<d&&c.plotY-b.plotY<d&&b.plotY-c.plotY<d||uc(a)}function _c(a){a.drag=!1,a.px=Jd.xForceToPlotScale.invert(a.plotX),a.py=Jd.yForceToPlotScale.invert(a.plotY);var b=d3.select(this);a.detached&&wc(b),a.pinned&&vc(b),Ge.selectAll("circle").classed({"pointer-events-none":!1}),Bd.on("mouseover.biblio",hc).on("mousemove.biblio",hc).on("mouseoout.biblio",hc);var c=Ie.filter(function(b){return b.patent_no!=a.patent_no});c.select("div.pop1-container").classed({"pointer-events-none":!1}),c.select("g.pop1-marker").classed({"pointer-events-none":!1});var b=d3.select(this);$(b.node()).on("mouseenter.biblio",dc),$(b.node()).on("mouseleave.biblio",fc),Qe.on("tick",Uc),Qe.stop(),Pe.alpha(Math.max(rd.alpha,.06))}function ad(a){if(a.drag=!0,a.orig_x=a.x,a.orig_y=a.y,a.orig_plotX=a.plotX,a.orig_plotY=a.plotY,Ge.filter(function(b){return b.patent_no!=a.patent_no}).selectAll("circle").classed({"pointer-events-none":!0}),Bd.on("mouseover.biblio",null).on("mousemove.biblio",null).on("mouseoout.biblio",null),"normal"==yd.mouse){var b=Ie.filter(function(b){return b.patent_no!=a.patent_no});b.select("div.pop1-container").classed({"pointer-events-none":!0}),b.select("g.pop1-marker").classed({"pointer-events-none":!0});var c=d3.select("div.bib[data-patent="+a.patent_no+"]");$(c.node()).off("mouseenter.biblio"),$(c.node()).off("mouseleave.biblio")}Pe.on("tick",Xc),rd.alpha=Pe.alpha(),Pe.stop(),a.fixed=!0}function bd(a){if("normal"==yd.mouse){var b=Ke.filter(function(b){return b.patent_no==a.patent_no}),c=1.7*a.markerRadius;b.size()>0&&$c(b,a.biblioNode,a,c)}}function cd(a){a.drag=!1,a.px=Jd.xForceToPlotScale.invert(a.plotX),a.py=Jd.yForceToPlotScale.invert(a.plotY);var b=Ke.filter(function(b){return b.patent_no==a.patent_no});if(a.biblioNode.detached&&wc(b),a.biblioNode.pinned&&vc(b),Ge.selectAll("circle").classed({"pointer-events-none":!1}),Bd.on("mouseover.biblio",hc).on("mousemove.biblio",hc).on("mouseoout.biblio",hc),"normal"==yd.mouse){var c=Ie.filter(function(b){return b.patent_no!=a.patent_no});c.select("div.pop1-container").classed({"pointer-events-none":!1}),c.select("g.pop1-marker").classed({"pointer-events-none":!1});var b=d3.select("div.bib[data-patent="+a.patent_no+"]");$(b.node()).on("mouseenter.biblio",dc),$(b.node()).on("mouseleave.biblio",fc)}Pe.on("tick",Wc),Pe.alpha(Math.max(rd.alpha,.06))}function dd(){if(d3.event.shiftKey&&!d3.event.defaultPrevented){d3.event.preventDefault(),d3.event.stopPropagation();var a=d3.selectAll("div.bib");switch(yd.mouse){case"normal":e("Mouse mode changed from normal to transparent"),c("transparent"),ed(a);break;case"transparent":e("Mouse mode changed from tranparent to normal"),c("normal"),ed(a),Ae&&ec(Ae.divBib)}}}function ed(a){switch(yd.mouse){case"transparent":a.select("g.pop1-marker").classed({"pointer-events-none":!0}),a.select("div.pop1-container").classed({"pointer-events-none":!0}),a.selectAll("rect.pop1-top-btn").classed({"pointer-events-none":!0});break;case"normal":a.select("div.pop1-container").classed({"pointer-events-none":!1}),a.select("g.pop1-marker").classed({"pointer-events-none":!1}),a.selectAll("rect.pop1-top-btn").classed({"pointer-events-none":!1})}}function fd(){window.focus(),$(document).click()}function gd(){!yd.shiftKey&&d3.event.shiftKey&&(yd.shiftKey=!0,Ie.select("div.pop1-container").classed({"default-cursor":!0}),Ie.selectAll("span.hide-result-btn").classed({"default-cursor":!0}),Ie.selectAll("a.pop1-patent-url, a.pop1-search-url").classed({"default-cursor":!0}),Ie.select("g.pop1-marker").classed({"default-cursor":!0}),Ge.select("circle").classed({"default-cursor":!0}))}function hd(){16==d3.event.keyCode&&(yd.shiftKey=!1,Ie.select("div.pop1-container").classed({"default-cursor":!1}),Ie.selectAll("span.hide-result-btn").classed({"default-cursor":!1}),Ie.selectAll("a.pop1-patent-url, a.pop1-search-url").classed({"default-cursor":!1}),Ie.select("g.pop1-marker").classed({"default-cursor":!1}),Ge.select("circle").classed({"default-cursor":!1}))}function id(){d3.event.shiftKey&&!d3.event.defaultPrevented?(d3.event.preventDefault(),d3.event.stopImmediatePropagation()):d3.event.preventDefault()}function jd(){d3.event.shiftKey&&!d3.event.defaultPrevented&&(d3.event.preventDefault(),d3.event.stopImmediatePropagation())}function kd(a,b){""!=a&&(e("In getEPOPatentData, patent query list is: ",a),$.ajax({type:"POST",url:"http://"+Nd+Od,xhrFields:{withCredentials:!0},contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{"Request Body":a,CacheKey:"refs_"+CryptoJS.MD5(a)},dataType:"json",success:b,error:function(a,b,c){e("In getEPOPatentData, error returned from POST request"),e(b),e(c),fe.reportError("HTTP error getting EPO patent data. Please try later.")}}))}function ld(a){if(a["ops:world-patent-data"]){var b=a["ops:world-patent-data"]["exchange-documents"]["exchange-document"];b=b instanceof Array?b:[b],e("Got "+b.length+" documents back from EPO");var c=[],d=[];dupList=[],notFoundList=[],USApplicationCount=0,b.sort(function(a,b){return!a["@status"]&&b.status?-1:a["@status"]&&!b.status?1:0});for(var f=0;f<b.length;f++){try{var g=b[f],h=g["@country"],i=g["@doc-number"],j=g["@kind"]?g["@kind"]:"",k=h+i+("US"==h?"":j);k+="US"!=h||"E"!=j.slice(0,1)&&"P"!=j.slice(0,1)&&"S"!=j.slice(0,1)?"":j.slice(0,1);var l=je[k];if(l in ie||"not found"==g["@status"]){ie[l]?"US"!=h||13!=l.length?(dupList.push(l),e("In on_get_EPO_date: patent "+("US"==h?l+j:l)+" is duplicate")):USApplicationCount+=1:(notFoundList.push(l),e("In on_get_EPO_date: patent "+l+" not found"));continue}var m="",n=g["bibliographic-data"]["publication-reference"];if(n){var o=n["document-id"];m=o instanceof Array?qb(o[1].date.$):""}var p="US"==h&&"B"==j[0],q=moment.utc(m).valueOf()<moment.utc("Jan 2, 2001");if(p&&q){e("In parseEPOPatentData: patent "+l+j+" is US_B pre-2001"),dupList.push(l+j);continue}var r="",s=g["abstract"];if(s&&(abstractP=s instanceof Array?s[0].p:s.p))if(abstractP instanceof Array){for(var t=[],u=0;u<abstractP.length;u++)t.push(abstractP[u].$);r=t.join(", ")}else r=abstractP.$;var v="",w=g["bibliographic-data"]["invention-title"];w&&(v=nd(w instanceof Array?w[0].$:w.$));var x=[],y=[],z=g["bibliographic-data"].parties;if(z){var A=z.applicants;if(A){var B=A.applicant;if(B instanceof Array){for(var C=0;C<B.length;C++)if("epodoc"==B[C]["@data-format"]){var D=B[C]["applicant-name"].name.$,E=rb(D);-1==x.indexOf(E)&&x.push(E)}}else{var D=B["applicant-name"].name.$,E=rb(D);x.push(E)}}var F=z.inventors;if(F){var G=F.inventor;if(G instanceof Array){for(var H=0;H<G.length;H++)if("epodoc"==G[H]["@data-format"]){var D=G[H]["inventor-name"].name.$,E=rb(D);-1==y.indexOf(E)&&y.push(E)}}else{var D=G["inventor-name"].name.$,E=rb(D);y.push(E)}}}for(var I=[],J=[],C=0;C<x.length;C++){var K=x[C];-1==y.indexOf(K)&&(K=md(K),I.push(K),J.push(tb(K)))}for(var H=0;H<y.length;H++){var E=pd(y[H]);y[H]=od(E,I)}if(0==I.length)for(var H=0;H<y.length;H++)I.push(y[H]),J.push(tb(y[H]));var L="",M=g["bibliographic-data"]["application-reference"];
if(M){var o=M["document-id"];o instanceof Array&&o[1].date&&(L=qb(o[1].date.$))}L=""==L?m:L}catch(N){d.push(l),e("In parseEPOPatentData, error thrown: "+N.name+": "+N.message),e("      Error parsing patent "+l),e(g);continue}var O=I.join(", "),P=J.sort().join(" "),Q=y.join(", ");ie[l]={},ie[l].title=""==v?"Title not available":v,ie[l]["abstract"]=""==r?"Not available":r,ie[l].pub_date=""==m?"N/A":m,ie[l].assignee=""==O?"Assignee not available":O,ie[l].shortAssignee=""==P?"Not available":P,ie[l].inventors=""==Q?"Inventors not available":Q,ie[l].file_date=L,c.push(l),e("In parseEPOPatentData: parsed patent "+l),e(g)}return e("In parseEPOPatentData, "+c.length+" successfully parsed patents:"),e(c),e("                    "+d.length+" patents not parsed:"),e(d),e("                    "+dupList.length+" patents were duplicates (between cited/citing and related lists?) or US_B pre-2001:"),e(dupList),e("US applications not found due to querying as both utility and plant applications: "+USApplicationCount),e("                    "+notFoundList.length+" patents not found:"),e(notFoundList),c}return e("In parseEPOPatentData, error getting EPO patent data:"),e(a),fe.reportError("Error from EPO patent API. Please try later."),!1}function md(a){return a.replace(/S A$|Sa$/,"SA").replace(/Llc/,"LLC").replace(/A G$|Ag$/,"AG").replace(/G M B H$|Gmbh$/,"GmbH").replace(" S ","'s ")}function nd(a){return a.toLowerCase().replace(/^\b\w/g,function(a){return a.toUpperCase()})}function od(a,b){for(var c=a,d=0;d<b.length;d++){var e=b[d];-1!=e.search(/Inc|Co|Llc|Ltd|Int|Tech|Ind|Nv/)&&(aList=e.match(/(\S+)/g),aList&&(aList.forEach(function(){c=c.replace(/\bval\b/g," ")}),c=c.replace(/\s+/g," ")))}return c}function pd(a){if(!a)return"";var b=a.match(/(\S+)/g);switch(b.forEach(function(a,b,c){1==a.length&&(c[b]+=".")}),b.length){case 0:return"";case 1:return b[1];case 2:return b[1]+" "+b[0];default:switch(b[0]){case"Von":case"Van":switch(b[0]=b[0].toLowerCase(),b[1]){case"De":case"Der":b[1]=b[1].toLowerCase(),b.push(b[0],b[1],b[2]),b=b.slice(3);break;default:b.push(b[0],b[1]),b=b.slice(2)}break;case"De":case"Del":switch(b[0]=b[0].toLowerCase(),b[1]){case"La":b[1]=b[1].toLowerCase(),b.push(b[0],b[1],b[2]),b=b.slice(3);break;default:b.push(b[0],b[1]),b=b.slice(2)}break;default:b.push(b[0]),b=b.slice(1)}}switch(b[0]){case"Ii":case"Iii":case"Iv":b[0]=b[0].toUpperCase();case"Jr":case"Sr":b.push(b[0]),b=b.slice(1)}return b.join(" ")}a();var qd=Math.min(window.screen.height,1024)-(window.outerHeight-window.innerHeight)-$("ul#topTabs").outerHeight()-30,rd={w:1e3,h:550,minDate:new Date("1976-01-01"),maxDate:new Date("2014-07-01"),alpha:.1},sd={padding:{top:0,bottom:0,left:0,right:0},border:{top:14,bottom:14,left:14,right:14},margin:{top:0,bottom:0,left:2,right:2}};sd.totH=sd.padding.left+sd.padding.right+sd.border.right+sd.border.left+sd.margin.left+sd.margin.right,sd.totV=sd.padding.top+sd.padding.bottom+sd.border.top+sd.border.bottom+sd.margin.top+sd.margin.bottom;var td={w:350,padding:{top:0,bottom:0,left:0,right:0},border:{top:2,bottom:2,left:2,right:2},margin:{top:0,bottom:5,left:0,right:0}};td.totW=td.w+td.padding.left+td.padding.right+td.border.right+td.border.left+td.margin.left+td.margin.right;var ud={w:Math.min(window.screen.width,1280)-(window.outerWidth-window.innerWidth)-td.totW-sd.totH-25,h:Math.min(window.screen.height,1024)-(window.outerHeight-window.innerHeight)-$("div.main-content").offset().top-sd.totV-30,margin:{top:18,bottom:35,left:18,right:18},nodeLegend:{w:128,h:100,margin:{top:10,bottom:10,left:10,right:5}}},vd={w:ud.w+sd.border.left+sd.border.right+sd.padding.left+sd.padding.right};$("div.top-force-container").css("width",vd.w+"px");var wd={w:ud.w-ud.margin.left-ud.margin.right,h:ud.h-ud.margin.top-ud.margin.bottom},xd={w:wd.w+1,h:wd.h+1},yd={zMin:0,zMax:0,mouse:"normal",shiftKey:!1,transformTime:.7,opacityTime:.3,transition:0},zd=["rgb(141,211,199)","rgb(255,255,179)","rgb(190,186,218)","rgb(251,128,114)","rgb(128,177,211)","rgb(253,180,98)","rgb(179,222,105)","rgb(252,205,229)","rgb(217,217,217)","rgb(188,128,189)","rgb(204,235,197)","rgb(255,237,111)"],Ad=d3.select("#Map").select("div.bib-container").style({width:xd.w+"px",height:xd.h+"px","margin-top":ud.margin.top+"px","margin-bottom":ud.margin.bottom+"px","margin-left":ud.margin.left+"px","margin-right":ud.margin.right+"px"}),Bd=d3.select("#Map").select("svg.main-svg").attr({width:ud.w,height:ud.h}),Cd=Bd.append("svg:g").attr("transform","translate("+ud.margin.left+","+ud.margin.top+")");Cd.append("svg:clipPath").attr({id:"clip"}).append("svg:rect").attr({width:wd.w,height:wd.h}),Cd.append("svg:clipPath").attr({id:"nodeClip"}).append("svg:circle").attr({id:"nodeMarker",r:7.5});var Dd=Cd.append("g").classed({"x-axis-label":!0}).attr({transform:"translate(0,"+wd.h+")"}),Ed=Cd.append("g").classed({"x-axis-grid":!0}).attr({transform:"translate(0,0)"}).style({stroke:"lightgray",fill:"transparent"}),Fd=Cd.append("svg:rect").attr({"class":"zoom-pane",width:wd.w,height:wd.h}),Gd=Cd.append("svg:g").classed({"force-plot":!0}).attr({"clip-path":"url(#clip)"}),Hd=Cd.append("svg:g").classed({legend:!0}).attr({transform:"translate(20, 18)"}),Id=Cd.append("svg:g").classed({"node-legend-container":!0}).attr({transform:"translate("+(wd.w-ud.nodeLegend.w-ud.nodeLegend.margin.right)+",9)"});d();var Jd=new b(rd,wd),Kd=!1;$(window).on("load",g);var Ld="",Md=new f,Nd="ec2-54-218-108-62.us-west-2.compute.amazonaws.com:8081",Od="/epoapi/biblio/";$(document).data("docDeferred",new $.Deferred);var Pd=$.get("/scripts/templates/templates.html",h);$.when(Pd,$(document).data("docDeferred")).done(i);var Qd,Rd,Sd,Td=new o,Ud={min:1,max:867e4},Vd=new q,Wd=new p,Xd,Yd,Zd,$d=0,_d=0,ae=0,be=/\/(?:patents|related)\/(\w+)(?:[\?#%&]|$)/,ce=["worldwide.espacenet.com","register.epo.org","register.dpma.de","uspto.gov","wipo.int","scholar.google.com","docs.google.com","sipo",".bibtex",".enw",".ris"],de=/([A-Z]{2})([A-Z]*)(\d+)([A-C,G]?(?=([A-Z]\d?)?$))/,ee,fe=new vb,ge={},he={},ie={},je={},ke={map:[],favorites:[],deleted:[],cleared:{map:[],target:[],deleted:[]},clearFlag:!1},le=[],me=[],ne=[],oe=[],pe={},qe={},re={},se=d3.time.format("%b %e, %Y");$("input.input-patent").on("keydown",wb).on("paste",wb).on("keyup",xb),$("span.btn-go").on("click",yb),$("button.btn-random").on("click",zb).on("mousedown",Nb),$("button.btn-fun").on("click",Ab).on("mousedown",Nb),$("button.btn-undo").on("click",Bb).on("mousedown",Nb),$("button.btn-clear").on("click",Gb).on("mousedown",Nb);var te=["US2834031","US6025810","US5571247","US4605000","US5606804","US6329919","US6099319","US4247283","CA2010302","US5107620","US5456625","US5394661","US5572207","US7283427","US766171","US748626","US2026082","US821393","US1909537","US5960411","US4378116","US3655201","US4708078","US6733797"],ue,ve,we,xe,ye=$("div.patent-list[data-listname='mapped']"),ze=$("div.patent-list[data-listname='favorites']"),Ae=void 0,Be=8,Ce=12,De=[],Ee=[],Fe={},Ge=[],He=[],Ie=[],Je=[],Ke=[],Le=[],Me=2,Ne={minWidth:300,maxWidth:350},Oe,Pe=d3.layout.force().size([rd.w,rd.h]).nodes(le).links(ne).gravity(.05).linkDistance(function(a){return Math.abs(a.source.x_fix-a.target.x_fix)}).charge(-100).linkStrength(.1).on("start",Tc).on("tick",Wc),Qe=d3.layout.force().size([rd.w,rd.h]).nodes(me).links([]).gravity(0).linkDistance(0).charge(0).linkStrength(0).on("tick",Uc),Re=Pe.drag().on("dragstart.biblio",ad).on("drag.biblio",bd).on("dragend.biblio",cd),Se=Qe.drag().on("dragstart.biblio",Yc).on("drag.biblio",Zc).on("dragend.biblio",_c);Jc();